import{R as A,S as L,u as D,j as I,V as S,w as x,H as T,n as C,s as h,p as _,o as q,l as E,b as B,d as G,W as K,X as N,x as V,y as W,m as j}from"./.pnpm-eed560c6.js";import{_ as O}from"./index-948f1fe0.js";window._AMapSecurityConfig={serviceHost:"https://amap.wangminan.me/_AMapService/backup"};const U=async()=>await A.load({key:"488832cc9add2a49a6f41bf8b8dbf109",version:"2.0",plugins:["AMap.Driving","AMap.Geocoder","AMap.Geolocation","AMap.ToolBar"]}),w=async c=>{const{data:l}=await L.get("https://sts.wangminan.me/amap"),s={key:l.WebApiKey,address:c,city:"西安"},n=await(await fetch(`https://restapi.amap.com/v3/geocode/geo?key=${s.key}&address=${s.address}&city=${s.city}`,{method:"GET"})).json();if(n.info!=="OK")throw new Error("获取经纬度失败");return n.geocodes[0].location.split(",")};const z=c=>(V("data-v-76213906"),c=c(),W(),c),H={class:"container"},F=z(()=>j("div",{id:"carpooling-route-map"},null,-1)),J={__name:"PreviewMap",setup(c){const l=D(),s=I();let i=S(null),n,u,d,g="",m={waypoints:[]};const y=async()=>{const t=await w(s.currentRoute.value.query.departurePoint);u=new n.LngLat(t[0],t[1]);const e=await w(s.currentRoute.value.query.arrivePoint);if(d=new n.LngLat(e[0],e[1]),g=s.currentRoute.value.query.passingPoint,g!==""){const o=g.split(",");for(const a of o){const r=await w(a);m.waypoints.push(new n.LngLat(r[0],r[1]))}}};function k(t){const e=$(t),o=new n.Marker({position:e[0],icon:"https://webapi.amap.com/theme/v1.3/markers/n/start.png",map:i.value}),a=new n.Marker({position:e[e.length-1],icon:"https://webapi.amap.com/theme/v1.3/markers/n/end.png",map:i.value}),r=new n.Polyline({path:e,isOutline:!0,outlineColor:"#ffeeee",borderWeight:2,strokeWeight:5,strokeColor:"#0091ff",lineJoin:"round"});r.setMap(i),i.value.setFitView([o,a,r])}function $(t){const e=[];let o=0,a=t.steps.length;for(;o<a;o++){const r=t.steps[o];let p=0,v=r.path.length;for(;p<v;p++)e.push(r.path[p])}return e}const f=async t=>{i.value=new t.Map("carpooling-route-map",{resizeEnable:!0,mapStyle:l.value?"amap://styles/dark":"amap://styles/normal",viewMode:"3D",zoom:15,center:[108.764362,34.028885]}),new t.Driving({policy:t.DrivingPolicy.LEAST_TIME,map:i.value}).search(u,d,m,function(o,a){o==="complete"?a.routes&&a.routes.length&&k(a.routes[0]):h({type:"danger",message:"路线规划失败，请检查输入地点是否在西安市范围内"})})};x(l,async t=>{console.log(t),await y(),await f(n)});const M=async()=>{const t=K({duration:0,forbidClick:!0,message:"注意: 由于URI SDK只允许一个途经点，因此如果您填入了多个途经点，我们默认使用第一个作为参数。"});let e=4;const o=setInterval(()=>{if(e--,e)t.message=`倒计时 ${e} 秒 
 注意: 由于URI SDK只允许一个途经点，因此如果您填入了多个途经点，我们默认使用只第一个作为参数。`;else{clearInterval(o),_();const a=`${u.lng},${u.lat},${s.currentRoute.value.query.departurePoint}`,r=`${d.lng},${d.lat},${s.currentRoute.value.query.arrivePoint}`,p=`${m.waypoints[0].lng},${m.waypoints[0].lat},${s.currentRoute.value.query.passingPoint}`,v="car",P=0,R="gaode",b=1;console.log(a),console.log(r),window.location.href=`https://uri.amap.com/navigation?' +
                    'policy=${P}&from=${a}&to=${r}&via=${p}&mode=${v}' +
                    '&coordinate=${R}&callnative=${b}`}},1e3)};return T(async()=>{C({duration:0,forbidClick:!0,message:"正在加载地图..."});try{n=await U(),await y(),await f(n)}catch{h({type:"danger",message:"地图加载失败"})}finally{_()}}),(t,e)=>{const o=N;return q(),E("div",H,[B(o,{title:"行程预览","left-text":"返回","right-text":"使用高德地图打开","left-arrow":"",onClickLeft:e[0]||(e[0]=a=>G(s).go(-1)),onClickRight:e[1]||(e[1]=a=>M())}),F])}}},Y=O(J,[["__scopeId","data-v-76213906"]]);export{Y as default};
