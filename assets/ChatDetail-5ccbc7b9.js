import{l as S,m as d,J as z,o as G,a as m,p as w,d as e,e as _,b as a,q as r,c as C,z as $,Y as U,s as I,N as q,G as F,P as M,Z as J,D as P,E as Q,y as p,aa as Y,I as Z,_ as j,R as A,Q as H}from"./.pnpm-2d117cc4.js";import{b as K,c as O}from"./index-406906e2.js";import{u as W}from"./index-555cb1a4.js";import{_ as X}from"./index-a75880ea.js";import"./index-a31a7085.js";const ee={class:"message-div"},te={class:"input-container"},ae={__name:"ChatDetail",setup(oe){const v=S();let u;const n=d({}),f=d("发送第一条信息后可见对方账号"),V=W(),{currentUser:T}=z(V),i=d(""),g=async()=>{const s=await K();s.code===2e3?s.result!==null&&(n.value=s.result.list.find(t=>t.toUserVo.id===u),f.value=n.value.toUserVo.username):I({type:"danger",message:`获取聊天详情失败,${s.msg}`})},b=async()=>{const s={toUserId:u,message:i.value},t=await O(s);t.code===2e3?(i.value="",await g()):I({type:"danger",message:`发送失败,${t.msg}`})};let c;G(async()=>{c=0,u=v.currentRoute.value.query.toUserId,await g()});const l=d(!0);return window.onscroll=function(){document.documentElement.scrollTop<5&&(l.value=!0),document.documentElement.scrollTop-c>10&&l.value?(l.value=!1,c=document.documentElement.scrollTop):c-document.documentElement.scrollTop>10&&!l.value&&(l.value=!0,c=document.documentElement.scrollTop)},(s,t)=>{const k=q,x=Y,D=Z,h=j,E=A,B=H,y=F,N=M,R=P,L=Q;return m(),w(U,null,[e(k,{title:f.value,"left-text":"返回","left-arrow":"",onClickLeft:t[0]||(t[0]=o=>_(v).go(-1))},null,8,["title"]),e(N,{finished:!0,"finished-text":"没有更多聊天了"},{default:a(()=>[(m(!0),w(U,null,J(n.value.chats,o=>(m(),C(y,{style:{"margin-top":"2%"},key:o,inset:""},{default:a(()=>[e(B,{class:"chatItem"},{default:a(()=>[e(E,null,{default:a(()=>[e(h,{span:"8",class:"avatar-col"},{default:a(()=>[e(D,{round:"",width:"3rem",height:"3rem",src:o.fromUserId===_(u)?n.value.toUserVo.avatar:_(T).user.userImage,fit:"cover"},{loading:a(()=>[e(x,{type:"spinner",size:"20"})]),_:2},1032,["src"]),r("div",null,[r("strong",null,p(o.fromUserId===n.value.toUserVo.id?n.value.toUserVo.username:"您"),1)])]),_:2},1024),e(h,{span:"16",class:"chat-col"},{default:a(()=>[r("div",null,[r("div",ee,p(o.message),1),r("div",null,p(o.sendTime),1)])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),r("div",te,[l.value?(m(),C(y,{key:0,class:"chat-input",inset:""},{default:a(()=>[e(L,{center:"",label:"您的留言","label-align":"center",rows:"1",modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=o=>i.value=o)},{button:a(()=>[e(R,{size:"small",type:"primary",icon:"guide-o",onClick:b})]),_:1},8,["modelValue"])]),_:1})):$("",!0)])],64)}}},ue=X(ae,[["__scopeId","data-v-89ac7834"]]);export{ue as default};
