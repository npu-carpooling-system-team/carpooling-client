import{m as y,l as B,o as $,a as l,n as i,d as r,e as b,b as m,p as M,y as o,c as g,s as n,N as x,B as G,E as F,_ as Q,$ as j,v as _,a0 as J,D as K}from"./.pnpm-835927bf.js";import{a as W,h as q,b as z,c as h,d as H,e as X,f as Y}from"./index-2ec295c8.js";import{_ as Z}from"./index-800a6380.js";import"./index-7bf2edfc.js";const ee={class:"btn-area"},ae={key:0},te={key:1,style:{"flex-direction":"row"}},se={key:2},ne={key:4},le={key:6},oe={key:7},re={key:8},ue={__name:"OrderDetail",setup(ie){const d=y(""),D=B(),a=y({}),u=new Map;u.set("ORDER_FORCE_CLOSED","订单强制结束"),u.set("PRE_ORDER_REQUEST_SUBMITTED","订单已提交"),u.set("PRE_ORDER_REQUEST_PASSED","订单已通过"),u.set("PRE_DEPARTURE_USER_CANCELLED","订单已被用户取消"),u.set("DRIVING_USER_CONFIRM_DEPARTURE","用户确认发车"),u.set("ARRIVED_USER_UNPAID","用户未支付"),u.set("PAID_WAITING_CALLBACK","已支付，等待回调"),u.set("ORDER_NORMAL_CLOSED","订单正常结束");const v=async()=>{const t=await W(d.value);t!==null&&t.code===2e3?a.value=t.result.result:t!==null?n({type:"danger",message:`加载订单具体信息失败,${t.msg}`}):n({type:"danger",message:"加载订单具体信息失败,请检查网络连接"})},E=y("");$(async()=>{d.value=D.currentRoute.value.query.orderId,await v(),E.value=JSON.parse(a.value.passingPoint).join(" "),document.getElementById("van-tab")!==null&&document.getElementById("van-tab").remove(),f.value=a.value.score===0?1:a.value.score});const C=async()=>{const t=[];a.value.passingPoint!==""&&t.push(JSON.parse(a.value.passingPoint)),window.location.href="#/main/driver/preview-map?departurePoint="+a.value.departurePoint+"&arrivePoint="+a.value.arrivePoint+"&passingPoint="+a.value.passingPoint+"&fromUrl=/main/carpooling/passenger-order"},O=async()=>{const t=await q(d.value);t!==null&&t.code===2e3?(n({type:"success",message:"确认发车成功"}),await v()):t!==null?n({type:"danger",message:`确认发车失败,${t.msg}`}):n({type:"danger",message:"确认发车失败,请检查网络连接"})},P=async()=>{const t=await X();if(t!==null&&t.code===2e3){const e=t.result.userCancelTimes;if(e>=3)J({title:"提示",message:`您本年度已经取消了${e}次订单,本次若强制取消订单将会直接进入收费流程`,confirmButtonText:"确认取消",cancelButtonText:"取消",confirmButtonColor:"#f00",showCancelButton:!0}).then(()=>!0).catch(()=>(n({type:"warning",message:"您已放弃取消订单"}),!1));else if(e!==0)return n({type:"warning",message:`您在半年内一共取消了${e}次订单,本次可直接取消`}),!0;return!0}else if(t!==null)return n({type:"danger",message:`获取取消次数失败,${t.msg}`}),!1;return n({type:"danger",message:"获取取消次数失败,请检查网络连接"}),!1},w=async t=>{const e=await Y(t);e!==null&&e.code===2e3?(n({type:"success",message:"取消订单成功"}),await v()):e!==null?n({type:"danger",message:`取消订单失败,${e.msg}`}):n({type:"danger",message:"取消订单失败,请检查网络连接"})},A=async()=>{await P()&&await w(d.value)},S=async()=>{const t=await z(d.value);t!==null&&t.code===2e3?(n({type:"success",message:"确认到达成功"}),await v()):t!==null?n({type:"danger",message:`确认到达失败,${t.msg}`}):n({type:"danger",message:"确认到达失败,请检查网络连接"})},R=y(!1),V=async t=>{if(t.name==="支付宝支付")try{const e=h(d.value);e!==null&&e.code===2e3?window.location.href=e.payUrl:e!==null?n({type:"danger",message:`支付失败,${e.msg}`}):n({type:"danger",message:"支付失败,请检查网络连接"})}finally{await v()}else n({type:"danger",message:"暂不支持该支付方式"})},U=[{name:"支付宝支付"}],f=y(0),I=async()=>{const t={score:f.value},e=H(d.value,t);e!==null&&e.code===2e3?(n({type:"success",message:"评分成功"}),await v()):e!==null?n({type:"danger",message:`评分失败,${e.msg}`}):n({type:"danger",message:"评分失败,请检查网络连接"})};return(t,e)=>{const N=x,c=K,p=G,T=F,k=Q,L=j;return l(),i("div",null,[r(N,{title:"订单详情","left-text":"返回","left-arrow":"",onClickLeft:e[0]||(e[0]=s=>b(D).go(-1))}),r(T,{inset:""},{default:m(()=>[r(c,{readonly:"",modelValue:a.value.departurePoint,"onUpdate:modelValue":e[1]||(e[1]=s=>a.value.departurePoint=s),name:"出发地",label:"出发地"},null,8,["modelValue"]),r(c,{readonly:"",modelValue:a.value.arrivePoint,"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.arrivePoint=s),name:"到达地",label:"到达地"},null,8,["modelValue"]),r(c,{readonly:"",modelValue:E.value,"onUpdate:modelValue":e[3]||(e[3]=s=>E.value=s),name:"途径地",label:"途径地"},null,8,["modelValue"]),r(p,{plain:"",block:"",type:"primary",size:"small",style:{width:"40%",margin:"2% auto"},onClick:e[4]||(e[4]=s=>C())},{default:m(()=>[_(" 预览行程路线 ")]),_:1}),r(c,{readonly:"",modelValue:a.value.departureTime,"onUpdate:modelValue":e[5]||(e[5]=s=>a.value.departureTime=s),name:"出发时间",label:"出发时间"},null,8,["modelValue"]),r(c,{readonly:"",modelValue:a.value.arriveTime,"onUpdate:modelValue":e[6]||(e[6]=s=>a.value.arriveTime=s),name:"到达时间",label:"到达时间"},null,8,["modelValue"]),a.value.status==="ORDER_NORMAL_CLOSED"?(l(),g(c,{key:0,readonly:"",modelValue:a.value.score,"onUpdate:modelValue":e[7]||(e[7]=s=>a.value.score=s),name:"行程评分",label:"本次行程评分"},null,8,["modelValue"])):o("",!0)]),_:1}),M("div",ee,[a.value.status==="PRE_ORDER_REQUEST_SUBMITTED"?(l(),i("div",ae,"正在等待司机确认")):o("",!0),a.value.status==="PRE_ORDER_REQUEST_PASSED"?(l(),i("div",te,[r(p,{plain:"",onClick:e[8]||(e[8]=s=>O())},{default:m(()=>[_(" 确认发车 ")]),_:1}),r(p,{plain:"",type:"danger",onClick:e[9]||(e[9]=s=>A())},{default:m(()=>[_(" 取消行程 ")]),_:1})])):o("",!0),a.value.status==="PRE_DEPARTURE_USER_CANCELLED"?(l(),i("div",se,"订单已被用户取消")):o("",!0),a.value.status==="DRIVING_USER_CONFIRM_DEPARTURE"?(l(),g(p,{key:3,plain:"",onClick:e[10]||(e[10]=s=>S())},{default:m(()=>[_(" 确认到达 ")]),_:1})):o("",!0),a.value.status==="ARRIVED_USER_UNPAID"?(l(),i("div",ne,"请您支付订单")):o("",!0),a.value.status==="ARRIVED_USER_UNPAID"?(l(),g(p,{key:5,plain:"",onClick:e[11]||(e[11]=s=>R.value=!0)},{default:m(()=>[_(" 开始支付 ")]),_:1})):o("",!0),a.value.status==="PAID_WAITING_CALLBACK"?(l(),i("div",le,"已支付，等待回调")):o("",!0),a.value.status==="ORDER_NORMAL_CLOSED"&&a.value.score===0?(l(),i("div",oe," 订单正常结束,请问本次行程评分 ")):o("",!0),a.value.status==="ORDER_NORMAL_CLOSED"&&a.value.score!==0?(l(),i("div",re," 订单正常结束 ")):o("",!0),a.value.status==="ORDER_NORMAL_CLOSED"?(l(),g(k,{key:9,modelValue:f.value,"onUpdate:modelValue":e[12]||(e[12]=s=>f.value=s),color:"#ffd21e","void-icon":"star"},null,8,["modelValue"])):o("",!0),a.value.status==="ORDER_NORMAL_CLOSED"&&a.value.score===0?(l(),g(p,{key:10,plain:"",onClick:e[13]||(e[13]=s=>I())},{default:m(()=>[_(" 确认提交评分 ")]),_:1})):o("",!0)]),r(L,{show:R.value,"onUpdate:show":e[14]||(e[14]=s=>R.value=s),actions:U,"cancel-text":"取消","close-on-click-action":"",onCancel:e[15]||(e[15]=s=>R.value=!1),description:"请选择支付方式",onSelect:V},null,8,["show"])])}}},pe=Z(ue,[["__scopeId","data-v-a531929e"]]);export{pe as default};
