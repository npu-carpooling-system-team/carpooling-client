import{s as k,t as $,q as C,k as x,l as f,H as b,m as N,o as v,c as g,a as d,v as _,y,b as w,T as B,Q as V,w as E,S as I,r as P,n as R,z as U,A as D,p as M}from"./.pnpm-cd511795.js";import{u as O,a as L}from"./index-aa4ad7b6.js";import{_ as q}from"./index-c293d2bf.js";import{_ as z}from"./index-f5a7dfcf.js";const A=o=>{C({duration:0,forbidClick:!0,message:o})},H=async()=>{A("正在加载您的个人信息");try{const{data:o}=await q.get("/api/user/info");return o}catch(o){k({type:"danger",message:`首页初始化失败,${o.message}`})}finally{$()}return null},Q={__name:"NavBar",setup(o){const t=x(),n=f("carpooling"),s=O(),{currentUser:a}=b(s),c=L(),{nav:l}=b(c),u=async()=>{const i=await H();i.code===2e3?s.$patch(e=>{e.currentUser=i.result.result}):k({type:"danger",message:`首页初始化失败,${i.msg},请刷新页面重试`})},p=(i,e)=>{c.$patch(r=>{r.nav.currentNav=i,r.nav.to=e})},h=f(!1),T=f(!1);return N(async()=>{a.value.user.isDeleted===1&&a.value.driver.isDeleted===1&&await u(),h.value=a.value.user.isDriver,T.value=a.value.user.isPassenger,n.value=l.value.currentNav,await t.push(l.value.to)}),(i,e)=>{const r=B,S=V;return v(),g(S,{modelValue:n.value,"onUpdate:modelValue":e[4]||(e[4]=m=>n.value=m)},{default:d(()=>[T.value?(v(),g(r,{key:0,name:"passenger",icon:"shop-o",to:"/main/passenger",onClick:e[0]||(e[0]=m=>p("passenger","/main/passenger"))},{default:d(()=>[_(" 我要拼车 ")]),_:1})):y("",!0),h.value?(v(),g(r,{key:1,name:"driver",icon:"logistics",to:"/main/driver",onClick:e[1]||(e[1]=m=>p("driver","/main/driver"))},{default:d(()=>[_(" 我要发车 ")]),_:1})):y("",!0),w(r,{name:"carpooling",icon:"todo-list-o",to:"/main/carpooling",onClick:e[2]||(e[2]=m=>p("carpooling","/main/carpooling"))},{default:d(()=>[_(" 我的行程 ")]),_:1}),w(r,{name:"my",icon:"user-o",to:"/main/my",onClick:e[3]||(e[3]=m=>p("my","/main/my"))},{default:d(()=>[_(" 我的 ")]),_:1})]),_:1},8,["modelValue"])}}};const j=o=>(U("data-v-5c580cfe"),o=o(),D(),o),F={class:"main-page-container"},G=j(()=>M("div",{class:"empty-content"},null,-1)),J={__name:"MainPage",setup(o){const t=f(!1),n=x(),s=["/main/carpooling","/main/passenger/passenger-home","/main/driver/driver-home","/main/my/my-home"];let a;return E(()=>n.currentRoute.value.path,c=>{a=0,t.value=s.indexOf(c)!==-1}),I((c,l,u)=>{s.indexOf(l.path)===-1?n.go(0):u()}),N(()=>{s.indexOf(n.currentRoute.value.path)!==-1&&(t.value=!0),a=0}),window.onscroll=function(){document.documentElement.scrollTop<5&&(a=0),s.indexOf(n.currentRoute.value.path)!==-1&&(document.documentElement.scrollTop-a>1&&t.value?(t.value=!1,a=document.documentElement.scrollTop):a-document.documentElement.scrollTop>1&&!t.value&&(t.value=!0,a=document.documentElement.scrollTop))},(c,l)=>{const u=P("router-view");return v(),R("div",F,[w(u,{class:"main-router-container"}),G,t.value?(v(),g(Q,{key:0,class:"nav-container"})):y("",!0)])}}},Z=z(J,[["__scopeId","data-v-5c580cfe"]]);export{Z as default};
