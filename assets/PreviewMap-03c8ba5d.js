import{a6 as L,a7 as D,u as B,l as S,a8 as q,w as T,o as x,t as C,s as _,v as $,K as E,a as U,p as K,d as N,a9 as G,N as O,A as V,B as W,q as j}from"./.pnpm-a881e205.js";import{_ as z}from"./index-8ef83aaa.js";window._AMapSecurityConfig={serviceHost:"https://amap.wangminan.me/_AMapService/backup"};const F=async()=>await L.load({key:"488832cc9add2a49a6f41bf8b8dbf109",version:"2.0",plugins:["AMap.Driving","AMap.Geocoder","AMap.Geolocation","AMap.ToolBar"]}),f=async i=>{const{data:u}=await D.get("https://sts.wangminan.me/amap"),n={key:u.WebApiKey,address:i,city:"西安"},s=await(await fetch(`https://restapi.amap.com/v3/geocode/geo?key=${n.key}&address=${n.address}&city=${n.city}`,{method:"GET"})).json();if(s.info!=="OK")throw new Error(`获取经纬度失败,我们建议您将地名 ${i} 修改为更精确的地址`);return s.geocodes[0].location.split(",")};const H=i=>(V("data-v-e386b2a6"),i=i(),W(),i),J={class:"container"},Q=H(()=>j("div",{id:"carpooling-route-map"},null,-1)),X={__name:"PreviewMap",setup(i){const u=B(),n=S();let c=q(null),s,d,m,p="",v="",g={waypoints:[]};const y=async()=>{const t=await f(n.currentRoute.value.query.departurePoint);d=new s.LngLat(t[0],t[1]);const e=await f(n.currentRoute.value.query.arrivePoint);if(m=new s.LngLat(e[0],e[1]),v=n.currentRoute.value.query.passingPoint,p=n.currentRoute.value.query.fromUrl,v!==""){const a=v.split(",");for(const o of a){const r=await f(o);g.waypoints.push(new s.LngLat(r[0],r[1]))}}};function k(t){const e=M(t),a=new s.Marker({position:e[0],icon:"https://webapi.amap.com/theme/v1.3/markers/n/start.png",map:c.value}),o=new s.Marker({position:e[e.length-1],icon:"https://webapi.amap.com/theme/v1.3/markers/n/end.png",map:c.value}),r=new s.Polyline({path:e,isOutline:!0,outlineColor:"#ffeeee",borderWeight:2,strokeWeight:5,strokeColor:"#0091ff",lineJoin:"round"});r.setMap(c),c.value.setFitView([a,o,r])}function M(t){const e=[];let a=0,o=t.steps.length;for(;a<o;a++){const r=t.steps[a];let l=0,w=r.path.length;for(;l<w;l++)e.push(r.path[l])}return e}const h=async t=>{c.value=new t.Map("carpooling-route-map",{resizeEnable:!0,mapStyle:u.value?"amap://styles/dark":"amap://styles/normal",viewMode:"3D",zoom:15,center:[108.764362,34.028885]}),new t.Driving({policy:t.DrivingPolicy.LEAST_TIME,map:c.value}).search(d,m,g,function(a,o){a==="complete"?o.routes&&o.routes.length&&k(o.routes[0]):_({type:"danger",message:"路线规划失败，请检查输入地点是否在西安市范围内"})})};T(u,async t=>{console.log(t),await y(),await h(s)});const P=async()=>{const t=G({duration:0,forbidClick:!0,message:"注意: 由于URI SDK只允许一个途经点，因此如果您填入了多个途经点，我们默认使用第一个作为参数。"});let e=4;const a=setInterval(()=>{if(e--,e)t.message=`倒计时 ${e} 秒 
 注意: 由于URI SDK只允许一个途经点，因此如果您填入了多个途经点，我们默认使用只第一个作为参数。`;else{clearInterval(a),$();const o=`${d.lng},${d.lat},${n.currentRoute.value.query.departurePoint}`,r=`${m.lng},${m.lat},${n.currentRoute.value.query.arrivePoint}`,l=`${g.waypoints[0].lng},${g.waypoints[0].lat},${n.currentRoute.value.query.passingPoint}`,w="car",R=0,A="gaode",I=1;window.location.href=`https://uri.amap.com/navigation?' +
                    'policy=${R}&from=${o}&to=${r}&via=${l}&mode=${w}' +
                    '&coordinate=${A}&callnative=${I}`}},1e3)};x(async()=>{C({duration:0,forbidClick:!0,message:"正在加载地图..."});try{s=await F(),await y(),await h(s)}catch(t){_({type:"danger",message:`地图加载失败,${t.message}`})}finally{$()}}),E(()=>{document.getElementById("carpooling-route-map").remove()});const b=async()=>{p!==""&&p!==null&&p!==void 0?window.location.href=`#${p}`:await n.go(-1)};return(t,e)=>{const a=O;return U(),K("div",J,[N(a,{title:"行程预览","left-text":"返回","right-text":"使用高德地图打开","left-arrow":"",onClickLeft:e[0]||(e[0]=o=>b()),onClickRight:e[1]||(e[1]=o=>P())}),Q])}}},ee=z(X,[["__scopeId","data-v-e386b2a6"]]);export{ee as default};
