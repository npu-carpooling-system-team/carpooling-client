import{m as s,l as z,o as J,s as n,a as Q,n as H,d as o,e as R,b as u,X,a0 as N,N as K,F as W,v as k,p as Y,H as Z,D as h,B as ee,a1 as ae,a2 as le,a3 as te,E as oe}from"./.pnpm-ba0d9b51.js";import{a as ne,u as re,d as se}from"./index-74bd0f2c.js";import{u as ie}from"./index-7f8e3267.js";import{_ as ue}from"./index-f537e1ea.js";import"./index-efafad75.js";const pe={class:"submit-carpooling-btn"},de={__name:"CarpoolingDetail",setup(me){const V=s(""),E=z(),i=s({}),t=s({id:"",departurePoint:"",arrivePoint:"",passingPoint:"",departureTime:"",arriveTime:"",description:"",totalPassengerNo:"",leftPassengerNo:"",price:""}),p=new Map;p.set("ORDER_FORCE_CLOSED","订单强制结束"),p.set("PRE_ORDER_REQUEST_SUBMITTED","订单已提交"),p.set("PRE_ORDER_REQUEST_PASSED","订单已通过"),p.set("PRE_DEPARTURE_USER_CANCELLED","订单已被用户取消"),p.set("DRIVING_USER_CONFIRM_DEPARTURE","用户确认发车"),p.set("DRIVING_USER_CONFIRM_ARRIVED","用户确认到达"),p.set("ARRIVED_USER_UNPAID","用户未支付"),p.set("ORDER_NORMAL_CLOSED","订单正常结束");const g=s(!1),f=s(!1),c=s(!1),y=s(!1),C=s(""),P=s(""),m=s(""),T=s(""),S=async()=>{const l=await ne(V.value);l!==null&&l.code===2e3?i.value=l.carpooling:l!==null?n({type:"danger",message:`加载订单具体信息失败,${l.msg}`}):n({type:"danger",message:"加载订单具体信息失败,请检查网络连接"})},I=async()=>{t.value=i.value,C.value=i.value.departureTime.split(" ")[0],P.value=i.value.departureTime.split(" ")[1],m.value=i.value.arriveTime.split(" ")[0],T.value=i.value.arriveTime.split(" ")[1],t.value.passingPoint=JSON.parse(i.value.passingPoint).join(" ")},v=s("");J(async()=>{const l=document.getElementById("van-tab");l!==null&&(l.style.display="none"),V.value=E.currentRoute.value.query.carpoolingId,await S(),i.value.departureTime.replace(/\//g,"-")>new Date().toLocaleString("zh",{hour12:!1})&&n({type:"warning",message:"请注意,该订单已经超出出发时间"}),v.value=JSON.parse(i.value.passingPoint).join(" "),await I()});const B=async()=>{const l=[];v.value!==""&&l.push(v.value.split(" ")),window.location.href="#/main/driver/preview-map?departurePoint="+t.value.departurePoint+"&arrivePoint="+t.value.arrivePoint+"&passingPoint="+l},$=()=>{const l=ie(),{currentUser:e}=Z(l);if(e.value.user.alipayId===""||e.value.user.alipayId===null)return n({type:"danger",message:"请先绑定支付宝"}),!1;if(t.value.departureTime>=t.value.arriveTime)return n({type:"danger",message:"到达时间应在出发时间之后"}),!1;let d=new Date().toLocaleString("zh",{hour12:!1});if(d=d.replace(/\//g,"-"),d.split("-")[1].length===1&&(d=d.replace(/-/,"-0")),t.value.departureTime<=d)return n({type:"danger",message:"出发时间应当在当前时间之后"}),!1;if((e.value.driver.driversLicenseType==="C1"||e.value.driver.driversLicenseType==="C2")&&t.value.totalPassengerNo>5)return n({type:"danger",message:"您的驾照类型不支持超过5人的拼车"}),!1;if(t.value.totalPassengerNo<t.value.leftPassengerNo)return n({type:"danger",message:"总乘客人数应大于等于剩余乘客人数"}),!1;const r=new Date(t.value.departureTime),w=new Date;return r.getTime()-w.getTime()<6*60*60*1e3?(n({type:"danger",message:"开车时间应在当前时间的六小时之后"}),!1):!0},O=async()=>{N({title:"提示",message:"确认修改拼车信息吗",confirmButtonText:"确定",cancelButtonText:"取消",confirmButtonColor:"#f00",showCancelButton:!0}).then(async()=>{if(t.value.passingPoint=JSON.stringify(v.value.split(" ")),t.value.departureTime=C.value+" "+P.value,t.value.arriveTime=m.value+" "+T.value,!$())return;const l=await re(t.value);l!==null&&l.code===2e3?n({type:"success",message:"修改成功,请到详情页查看"}):l!==null&&l.msg!==null?n({type:"danger",message:`修改失败,${l.msg}`}):n({type:"danger",message:"修改失败"})}).catch(()=>{n({type:"primary",message:"已取消修改"})})},x=async l=>{N({title:"提示",message:"确认删除拼车行程吗",confirmButtonText:"确定",cancelButtonText:"取消",confirmButtonColor:"#f00",showCancelButton:!0}).then(async()=>{const e=await se(l);e.code===2e3?(n({type:"success",message:"删除成功,请到详情页查看"}),window.location.href="#/main/carpooling/driver-carpooling"):e.msg!==null?n({type:"danger",message:`删除失败,${e.msg}`}):n({type:"danger",message:"删除失败"})}).catch(()=>{n({type:"primary",message:"已取消删除"})})},L=()=>{window.location.href=`#/main/carpooling/carpooling-reserve-list?carpoolingId=${V.value}`},q=({selectedValues:l})=>{C.value=l.join("-"),m.value=l.join("-"),g.value=!1},A=({selectedValues:l})=>{P.value=l.join(":"),c.value=!1},j=({selectedValues:l})=>{m.value=l.join("-"),f.value=!1},F=({selectedValues:l})=>{T.value=l.join(":"),y.value=!1},U=new Date;return(l,e)=>{const d=K,r=h,w=ee,b=ae,D=le,_=te,M=oe,G=W;return Q(),H(X,null,[o(d,{title:"订单详情","left-text":"返回","right-text":"查看申请列表","left-arrow":"",onClickLeft:e[0]||(e[0]=a=>R(E).go(-1)),onClickRight:e[1]||(e[1]=a=>L())}),o(G,{onSubmit:e[27]||(e[27]=a=>O())},{default:u(()=>[o(M,{inset:""},{default:u(()=>[o(r,{modelValue:t.value.departurePoint,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.departurePoint=a),name:"出发地",label:"出发地",placeholder:"请输入出发地点",rules:[{required:!0,message:"请输入出发地点"}]},null,8,["modelValue"]),o(r,{modelValue:t.value.arrivePoint,"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.arrivePoint=a),name:"到达地",label:"到达地",placeholder:"请输入到达地点",rules:[{required:!0,message:"请输入到达地点"}]},null,8,["modelValue"]),o(r,{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=a=>v.value=a),name:"途径地",label:"途径地",placeholder:"多个途径地点之间请用空格隔开"},null,8,["modelValue"]),o(w,{plain:"",block:"",type:"primary",size:"small",style:{width:"40%",margin:"2% auto"},onClick:e[5]||(e[5]=a=>B())},{default:u(()=>[k(" 预览行程路线 ")]),_:1}),o(r,{modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=a=>C.value=a),"is-link":"",name:"departureDatePicker",label:"出发日期",placeholder:"点击选择出发日期",onClick:e[7]||(e[7]=a=>g.value=!0),rules:[{required:!0,message:"请选择出发日期"}]},null,8,["modelValue"]),o(D,{show:g.value,"onUpdate:show":e[9]||(e[9]=a=>g.value=a),position:"bottom"},{default:u(()=>[o(b,{"min-date":R(U),onConfirm:q,onCancel:e[8]||(e[8]=a=>g.value=!1)},null,8,["min-date"])]),_:1},8,["show"]),o(r,{modelValue:P.value,"onUpdate:modelValue":e[10]||(e[10]=a=>P.value=a),"is-link":"",name:"departureTimePicker",label:"出发时间",placeholder:"点击选择出发时间",onClick:e[11]||(e[11]=a=>c.value=!0),rules:[{required:!0,message:"请输入出发时间"}]},null,8,["modelValue"]),o(D,{show:c.value,"onUpdate:show":e[13]||(e[13]=a=>c.value=a),position:"bottom"},{default:u(()=>[o(_,{onConfirm:A,onCancel:e[12]||(e[12]=a=>c.value=!1)})]),_:1},8,["show"]),o(r,{modelValue:m.value,"onUpdate:modelValue":e[14]||(e[14]=a=>m.value=a),"is-link":"",name:"arriveDatePicker",label:"到达日期",placeholder:"选择到达日期(默认当日到达)",onClick:e[15]||(e[15]=a=>f.value=!0),rules:[{required:!0,message:"请选择到达日期"}]},null,8,["modelValue"]),o(D,{show:f.value,"onUpdate:show":e[17]||(e[17]=a=>f.value=a),position:"bottom"},{default:u(()=>[o(b,{"min-date":R(U),onConfirm:j,onCancel:e[16]||(e[16]=a=>f.value=!1)},null,8,["min-date"])]),_:1},8,["show"]),o(r,{modelValue:T.value,"onUpdate:modelValue":e[18]||(e[18]=a=>T.value=a),"is-link":"",name:"arriveTimePicker",label:"到达时间",placeholder:"选择到达时间",onClick:e[19]||(e[19]=a=>y.value=!0),rules:[{required:!0,message:"请选择到达时间"}]},null,8,["modelValue"]),o(D,{show:y.value,"onUpdate:show":e[21]||(e[21]=a=>y.value=a),position:"bottom"},{default:u(()=>[o(_,{onConfirm:F,onCancel:e[20]||(e[20]=a=>y.value=!1)})]),_:1},8,["show"]),o(r,{modelValue:t.value.description,"onUpdate:modelValue":e[22]||(e[22]=a=>t.value.description=a),name:"行程描述",label:"行程描述",placeholder:"请输入行程描述",rules:[{required:!0,message:"请输入行程描述"}]},null,8,["modelValue"]),o(r,{modelValue:t.value.totalPassengerNo,"onUpdate:modelValue":e[23]||(e[23]=a=>t.value.totalPassengerNo=a),name:"总座位数",label:"总座位数",placeholder:"请输入总座位数",type:"digit",rules:[{required:!0,message:"请输入总座位数"}]},null,8,["modelValue"]),o(r,{modelValue:t.value.leftPassengerNo,"onUpdate:modelValue":e[24]||(e[24]=a=>t.value.leftPassengerNo=a),name:"剩余座位数",label:"剩余座位数",placeholder:"一般与总座位数一致",type:"digit",rules:[{required:!0,message:"请输入剩余座位数"}]},null,8,["modelValue"]),o(r,{modelValue:t.value.price,"onUpdate:modelValue":e[25]||(e[25]=a=>t.value.price=a),name:"价格",label:"价格",placeholder:"您期望收取乘客的价格",type:"digit",rules:[{required:!0,message:"请输入价格"}]},null,8,["modelValue"]),Y("div",pe,[o(w,{plain:"",block:"",type:"primary","native-type":"submit"},{default:u(()=>[k(" 修改行程 ")]),_:1}),o(w,{plain:"",block:"",type:"danger",onClick:e[26]||(e[26]=a=>x(t.value.id))},{default:u(()=>[k(" 删除行程 ")]),_:1})])]),_:1})]),_:1})],64)}}},Ce=ue(de,[["__scopeId","data-v-8fec5fcf"]]);export{Ce as default};
