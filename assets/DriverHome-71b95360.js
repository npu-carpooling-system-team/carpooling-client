import{S as z,l as n,s as p,q as H,p as J,M as $,k as M,K as O,V as R,o as E,m as G,b as r,a as u,F as K,t as w,n as k,d as W,y as X,z as Y,A as Q,B as Z,W as ee,X as ae,Y as le,D as oe}from"./.pnpm-64d71ea9.js";import{u as re}from"./index-2e271261.js";import{_ as te}from"./index-73442fa0.js";import{_ as ne}from"./index-37c31092.js";const se=z("carpoolingCache",()=>({carpoolingCache:n({departureTime:"",arriveTime:"",departurePoint:"",arrivePoint:"",passingPoint:"",description:"",totalPassengerNo:"",leftPassengerNo:"",price:""})}),{persist:{storage:sessionStorage,paths:["carpoolingCache"],key:"carpoolingCache"}}),ie=s=>{J({duration:0,forbidClick:!0,message:s})},ue=async s=>{ie("正在上传拼车信息");try{const{data:v}=await te.post("/api/carpooling/driver/carpooling",s);return v}catch(v){p({type:"danger",message:`上传拼车信息失败,${v.message}`})}finally{H()}return!1};const _=s=>(X("data-v-8f157e26"),s=s(),Y(),s),pe={class:"driver-home-container"},de=_(()=>k("h2",null,"添加您的行程",-1)),ve=_(()=>k("p",null,"您确认添加行程则代表您认可我们的",-1)),me={class:"submit-login-btn"},ge={__name:"DriverHome",setup(s){const v=se(),{carpoolingCache:d}=$(v),D=M(),l=n({departureTime:"",arriveTime:"",departurePoint:"",arrivePoint:"",passingPoint:"",description:"",totalPassengerNo:"",leftPassengerNo:"",price:""}),i=n(""),q=async()=>{if(l.value.departurePoint===""||l.value.arrivePoint===""){p({type:"danger",message:"请输入出发与到达地点"});return}const o=[];i.value!==""&&o.push(i.value.split(" ")),await D.push("/main/driver/preview-map?departurePoint="+l.value.departurePoint+"&arrivePoint="+l.value.arrivePoint+"&passingPoint="+o)},P=n(!1),y=n(!1),C=n(!1),V=n(!1),g=n(""),f=n(""),m=n(""),c=n(""),j=({selectedValues:o})=>{g.value=o.join("-"),m.value=o.join("-"),P.value=!1},x=({selectedValues:o})=>{f.value=o.join(":"),C.value=!1},A=({selectedValues:o})=>{m.value=o.join("-"),y.value=!1},B=({selectedValues:o})=>{c.value=o.join(":"),V.value=!1},h=()=>{if(l.value.departureTime>=l.value.arriveTime)return p({type:"danger",message:"到达时间应在出发时间之后"}),!1;let o=new Date().toLocaleString("zh",{hour12:!1});if(o=o.replace(/\//g,"-"),o.split("-")[1].length===1&&(o=o.replace(/-/,"-0")),l.value.departureTime<=o)return p({type:"danger",message:"出发时间应当在当前时间之后"}),!1;const e=re(),{currentUser:t}=$(e);return(t.value.driver.driversLicenseType==="C1"||t.value.driver.driversLicenseType==="C2")&&l.value.totalPassengerNo>5?(p({type:"danger",message:"您的驾照类型不支持超过5人的拼车"}),!1):l.value.totalPassengerNo<l.value.leftPassengerNo?(p({type:"danger",message:"总乘客人数应大于等于剩余乘客人数"}),!1):!0},N=()=>{l.value={departureTime:"",arriveTime:"",departurePoint:"",arrivePoint:"",passingPoint:"",description:"",totalPassengerNo:"",leftPassengerNo:"",price:""},i.value="",g.value="",f.value="",m.value="",c.value="",v.$patch(o=>{o.carpoolingCache=l.value})},F=async()=>{if(l.value.passingPoint=JSON.stringify(i.value.split(" ")),l.value.departureTime=g.value+" "+f.value,l.value.arriveTime=m.value+" "+c.value,!h())return;const o=await ue(l.value);o.code===2e3?(p({type:"success",message:"发布成功,请到详情页查看"}),N()):o.msg!==null?p({type:"danger",message:`发布失败,${o.msg}`}):p({type:"danger",message:"发布失败"})};return O(()=>{d.value.departurePoint!==""&&(l.value=d.value,i.value=d.value.passingPoint===""?"":JSON.parse(d.value.passingPoint).join(" "),g.value=d.value.departureTime.split(" ")[0],f.value=d.value.departureTime.split(" ")[1],m.value=d.value.arriveTime.split(" ")[0],c.value=d.value.arriveTime.split(" ")[1])}),R(()=>{l.value.passingPoint=i.value===""?"":JSON.stringify(i.value.split(" ")),v.$patch(o=>{o.carpoolingCache=l.value})}),(o,e)=>{const t=Q,b=Z,U=ee,T=ae,S=le,L=oe,I=K;return E(),G("div",pe,[de,r(I,{onSubmit:e[26]||(e[26]=a=>F())},{default:u(()=>[r(L,{inset:""},{default:u(()=>[r(t,{modelValue:l.value.departurePoint,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.departurePoint=a),name:"出发地",label:"出发地",placeholder:"请输入出发地点",rules:[{required:!0,message:"请输入出发地点"}]},null,8,["modelValue"]),r(t,{modelValue:l.value.arrivePoint,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.arrivePoint=a),name:"到达地",label:"到达地",placeholder:"请输入到达地点",rules:[{required:!0,message:"请输入到达地点"}]},null,8,["modelValue"]),r(t,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=a=>i.value=a),name:"途径地",label:"途径地",placeholder:"多个途径地点之间请用空格隔开"},null,8,["modelValue"]),r(b,{plain:"",block:"",type:"primary",size:"small",style:{width:"40%",margin:"2% auto"},onClick:e[3]||(e[3]=a=>q())},{default:u(()=>[w(" 预览行程路线 ")]),_:1}),r(t,{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=a=>g.value=a),"is-link":"",readonly:"",name:"departureDatePicker",label:"出发日期",placeholder:"点击选择出发日期",onClick:e[5]||(e[5]=a=>P.value=!0),rules:[{required:!0,message:"请选择出发日期"}]},null,8,["modelValue"]),r(T,{show:P.value,"onUpdate:show":e[7]||(e[7]=a=>P.value=a),position:"bottom"},{default:u(()=>[r(U,{onConfirm:j,onCancel:e[6]||(e[6]=a=>P.value=!1)})]),_:1},8,["show"]),r(t,{modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=a=>f.value=a),"is-link":"",readonly:"",name:"departureTimePicker",label:"出发时间",placeholder:"点击选择出发时间",onClick:e[9]||(e[9]=a=>C.value=!0),rules:[{required:!0,message:"请输入出发时间"}]},null,8,["modelValue"]),r(T,{show:C.value,"onUpdate:show":e[11]||(e[11]=a=>C.value=a),position:"bottom"},{default:u(()=>[r(S,{onConfirm:x,onCancel:e[10]||(e[10]=a=>C.value=!1)})]),_:1},8,["show"]),r(t,{modelValue:m.value,"onUpdate:modelValue":e[12]||(e[12]=a=>m.value=a),"is-link":"",readonly:"",name:"arriveDatePicker",label:"到达日期",placeholder:"选择到达日期(默认当日到达)",onClick:e[13]||(e[13]=a=>y.value=!0),rules:[{required:!0,message:"请选择到达日期"}]},null,8,["modelValue"]),r(T,{show:y.value,"onUpdate:show":e[15]||(e[15]=a=>y.value=a),position:"bottom"},{default:u(()=>[r(U,{onConfirm:A,onCancel:e[14]||(e[14]=a=>y.value=!1)})]),_:1},8,["show"]),r(t,{modelValue:c.value,"onUpdate:modelValue":e[16]||(e[16]=a=>c.value=a),"is-link":"",readonly:"",name:"arriveTimePicker",label:"到达时间",placeholder:"选择到达时间",onClick:e[17]||(e[17]=a=>V.value=!0),rules:[{required:!0,message:"请选择到达时间"}]},null,8,["modelValue"]),r(T,{show:V.value,"onUpdate:show":e[19]||(e[19]=a=>V.value=a),position:"bottom"},{default:u(()=>[r(S,{onConfirm:B,onCancel:e[18]||(e[18]=a=>V.value=!1)})]),_:1},8,["show"]),r(t,{modelValue:l.value.description,"onUpdate:modelValue":e[20]||(e[20]=a=>l.value.description=a),name:"行程描述",label:"行程描述",placeholder:"请输入行程描述",rules:[{required:!0,message:"请输入行程描述"}]},null,8,["modelValue"]),r(t,{modelValue:l.value.totalPassengerNo,"onUpdate:modelValue":e[21]||(e[21]=a=>l.value.totalPassengerNo=a),name:"总座位数",label:"总座位数",placeholder:"请输入总座位数",type:"digit",rules:[{required:!0,message:"请输入总座位数"}]},null,8,["modelValue"]),r(t,{modelValue:l.value.leftPassengerNo,"onUpdate:modelValue":e[22]||(e[22]=a=>l.value.leftPassengerNo=a),name:"剩余座位数",label:"剩余座位数",placeholder:"一般与总座位数一致",type:"digit",rules:[{required:!0,message:"请输入剩余座位数"}]},null,8,["modelValue"]),r(t,{modelValue:l.value.price,"onUpdate:modelValue":e[23]||(e[23]=a=>l.value.price=a),name:"价格",label:"价格",placeholder:"您期望收取乘客的价格",type:"digit",rules:[{required:!0,message:"请输入价格"}]},null,8,["modelValue"]),k("div",null,[ve,k("p",{style:{color:"#5CA0FF"},onClick:e[24]||(e[24]=a=>W(D).push("/main/driver/fee-policy"))}," 服务费率政策 ")]),k("div",me,[r(b,{plain:"",block:"",type:"primary","native-type":"submit"},{default:u(()=>[w(" 添加行程 ")]),_:1}),r(b,{plain:"",block:"",type:"success",onClick:e[25]||(e[25]=a=>N())},{default:u(()=>[w(" 清空数据 ")]),_:1})])]),_:1})]),_:1})])}}},Ce=ne(ge,[["__scopeId","data-v-8f157e26"]]);export{Ce as default};
