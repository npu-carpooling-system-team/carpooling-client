import{l as A,m as r,o as M,a as D,n as b,d as t,b as o,p as $,V as S,s as P,F as Q,O as Y,v as m,e as N,Y as Z,B as J,_ as K,D as W,$ as X,a0 as ee,a1 as ae,E as te,c as le,x as v,Z as oe,R as ne,P as se,z as re,A as ue}from"./.pnpm-33e9fd8e.js";import{h as ie}from"./index-298f05d4.js";import{_ as de}from"./index-106ae9d8.js";import"./index-85061a81.js";const pe=f=>(re("data-v-30a15726"),f=f(),ue(),f),me={class:"carpooling-card-container"},ve=pe(()=>$("span",null,"-->",-1)),ce={__name:"PassengerHome",setup(f){const B=A(),u=r(""),i=r(""),l=r({pageNum:1,pageSize:10,query:"",departureTime:"",arriveTime:""}),I=new Date;let h=new Date;h.setDate(new Date().getDate()+2);const c=r(!1),_=r(!1),T=r([]),g=r(!1),w=r(!1);let d={query:"",departureTime:"",arriveTime:""};const y=async n=>{if(n||l.value.pageNum++,(d.query!==l.value.query||d.departureTime!==l.value.departureTime||d.arriveTime!==l.value.arriveTime)&&(l.value.pageNum=1,w.value=!1),g.value=!0,u.value!==""&&(l.value.departureTime=u.value,i.value!==""?l.value.departureTime=l.value.departureTime+" "+i.value:l.value.departureTime=l.value.departureTime+" 00:00"),u.value===""&&i.value!==""){P({type:"danger",message:"请选择出发日期"});return}const e=await ie(l.value);if(e===null&&P({type:"danger",message:"获取拼车列表失败: 服务器错误"}),e.code===2e3){const k=new Date().toISOString().slice(0,19).replace("T"," ");for(let p=0;p<e.data.length;p++)e.data[p].departureTime<k&&(e.data.splice(p,1),p--);d.query!==l.value.query||d.departureTime!==l.value.departureTime||d.arriveTime!==l.value.arriveTime?(T.value=[],T.value.push(...e.data),d={query:l.value.query,departureTime:l.value.departureTime,arriveTime:l.value.arriveTime}):T.value.push(...e.data),e.total!==l.value.pageSize&&(w.value=!0)}else P({type:"danger",message:`获取拼车列表失败：${e.msg}`});g.value=!1};M(async()=>{await y(!0)});const L=({selectedValues:n})=>{u.value=n.join("-"),c.value=!1},U=({selectedValues:n})=>{i.value=n.join(":"),_.value=!1},F=()=>{u.value="",c.value=!1},z=()=>{i.value="",_.value=!1},H=async n=>{await B.push(`/main/passenger/carpooling-detail?id=${n.id}`)};return(n,e)=>{const k=J,p=K,V=W,R=X,q=ee,j=ae,x=te,E=Q,s=oe,C=ne,G=se,O=Y;return D(),b(S,null,[t(E,{class:"searchForm"},{default:o(()=>[t(x,{inset:""},{default:o(()=>[t(p,{label:"搜索",modelValue:l.value.query,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.query=a),"show-action":"",placeholder:"请输入搜索关键词",onClear:e[2]||(e[2]=a=>y())},{action:o(()=>[t(k,{plain:"",block:"",type:"primary",size:"mini",onClick:e[0]||(e[0]=a=>y())},{default:o(()=>[m(" 搜索 ")]),_:1})]),_:1},8,["modelValue"]),t(V,{modelValue:u.value,"onUpdate:modelValue":e[3]||(e[3]=a=>u.value=a),"is-link":"",readonly:"",name:"departureDatePicker",label:"出发日期",placeholder:"点击选择出发日期(可空)",onClick:e[4]||(e[4]=a=>c.value=!0),clearable:""},null,8,["modelValue"]),t(q,{show:c.value,"onUpdate:show":e[5]||(e[5]=a=>c.value=a),position:"bottom"},{default:o(()=>[t(R,{"min-date":N(I),"max-date":N(h),onConfirm:L,onCancel:F},null,8,["min-date","max-date"])]),_:1},8,["show"]),t(V,{modelValue:i.value,"onUpdate:modelValue":e[6]||(e[6]=a=>i.value=a),"is-link":"",readonly:"",name:"departureTimePicker",label:"出发时间",placeholder:"点击选择出发时间(可空)",onClick:e[7]||(e[7]=a=>_.value=!0)},null,8,["modelValue"]),t(q,{show:_.value,"onUpdate:show":e[8]||(e[8]=a=>_.value=a),position:"bottom"},{default:o(()=>[t(j,{onConfirm:U,onCancel:z})]),_:1},8,["show"])]),_:1})]),_:1}),$("div",me,[t(O,{loading:g.value,"onUpdate:loading":e[9]||(e[9]=a=>g.value=a),finished:w.value,"finished-text":"没有更多行程了",onLoad:y},{default:o(()=>[(D(!0),b(S,null,Z(T.value,a=>(D(),le(x,{inset:"",style:{"margin-top":"2%"},key:a},{default:o(()=>[t(G,{class:"carpoolingItem",onClick:_e=>H(a)},{default:o(()=>[t(C,null,{default:o(()=>[t(s,{span:"12"},{default:o(()=>[m(v(a.departurePoint),1)]),_:2},1024),t(s,{span:"12"},{default:o(()=>[m(v(a.arrivePoint),1)]),_:2},1024)]),_:2},1024),t(C,null,{default:o(()=>[t(s,{span:"11"},{default:o(()=>[m(v(a.departureTime),1)]),_:2},1024),t(s,{span:"2"},{default:o(()=>[ve]),_:1}),t(s,{span:"11"},{default:o(()=>[m(v(a.arriveTime),1)]),_:2},1024)]),_:2},1024),t(C,null,{default:o(()=>[t(s,{span:"11"},{default:o(()=>[m(" 价格: "+v(a.price),1)]),_:2},1024),t(s,{span:"2"}),t(s,{span:"11"},{default:o(()=>[m(" 余座: "+v(a.leftPassengerNo),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1},8,["loading","finished"])])],64)}}},we=de(ce,[["__scopeId","data-v-30a15726"]]);export{we as default};
