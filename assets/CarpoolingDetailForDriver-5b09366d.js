import{m as n,l as O,o as q,a as F,n as L,d as o,e as B,b as u,X as M,s as i,H as G,N as j,F as J,v as T,p as z,D as Q,B as H,a2 as X,a3 as x,a4 as K,E as W}from"./.pnpm-835927bf.js";import{a as Y,b as Z}from"./index-1cc9fab0.js";import{u as h}from"./index-afc3e635.js";import{_ as ee}from"./index-f075622e.js";import"./index-7bf2edfc.js";const ae={class:"submit-carpooling-btn"},le={__name:"CarpoolingDetailForDriver",setup(oe){const V=n(""),y=O(),t=n({}),a=n({id:"",departurePoint:"",arrivePoint:"",passingPoint:"",departureDate:"",departureTime:"",arriveDate:"",arriveTime:"",description:"",totalPassengerNo:"",leftPassengerNo:"",price:""}),d=new Map;d.set("ORDER_FORCE_CLOSED","订单强制结束"),d.set("PRE_ORDER_REQUEST_SUBMITTED","订单已提交"),d.set("PRE_ORDER_REQUEST_PASSED","订单已通过"),d.set("PRE_DEPARTURE_USER_CANCELLED","订单已被用户取消"),d.set("DRIVING_USER_CONFIRM_DEPARTURE","用户确认发车"),d.set("DRIVING_USER_CONFIRM_ARRIVED","用户确认到达"),d.set("ARRIVED_USER_UNPAID","用户未支付"),d.set("ORDER_NORMAL_CLOSED","订单正常结束");const m=n(!1),v=n(!1),g=n(!1),f=n(!1),E=n(""),k=n(""),b=n(""),U=n(""),N=async()=>{const r=await Y(V.value);r!==null&&r.code===2e3?(t.value=r.carpooling,console.log(t.value)):r!==null?i({type:"danger",message:`加载订单具体信息失败,${r.msg}`}):i({type:"danger",message:"加载订单具体信息失败,请检查网络连接"})},_=async()=>{a.value=t.value,a.value.departureDate=t.value.departureTime.split(" ")[0],a.value.departureTime=t.value.departureTime.split(" ")[1],a.value.arriveDate=t.value.arriveTime.split(" ")[0],a.value.arriveTime=t.value.arriveTime.split(" ")[1],a.value.passingPoint=JSON.parse(t.value.passingPoint).join(" "),console.log(a)},D=n("");q(async()=>{V.value=y.currentRoute.value.query.carpoolingId,await N(),D.value=JSON.parse(t.value.passingPoint).join(" "),await _()});const S=async()=>{const r=[];t.value.passingPoint!==""&&r.push(a.value.passingPoint),window.location.href="#/main/driver/preview-map?departurePoint="+t.value.departurePoint+"&arrivePoint="+t.value.arrivePoint+"&passingPoint="+t.value.passingPoint},c=async()=>{if(a.value.passingPoint=JSON.stringify(D.value.split(" ")),a.value.departureTime=E.value+" "+k.value,a.value.arriveTime=b.value+" "+U.value,!I())return;const r=await Z(a.value);r.code===2e3?(i({type:"success",message:"发布成功,请到详情页查看"}),clearAddCarpoolingDto()):r.msg!==null?i({type:"danger",message:`发布失败,${r.msg}`}):i({type:"danger",message:"发布失败"})},I=()=>{const r=h(),{currentUser:e}=G(r);if(e.value.user.alipayId===""||e.value.user.alipayId===null)return i({type:"danger",message:"请先绑定支付宝"}),!1;if(console.log(a.value.departureTime),console.log(a.value.arriveTime),console.log(a.value),a.value.departureTime>=updateCarpoolpingDto.value.arriveTime)return console.log(a.value),i({type:"danger",message:"到达时间应在出发时间之后"}),!1;let p=new Date().toLocaleString("zh",{hour12:!1});return p=p.replace(/\//g,"-"),p.split("-")[1].length===1&&(p=p.replace(/-/,"-0")),a.value.departureTime<=p?(i({type:"danger",message:"出发时间应当在当前时间之后"}),!1):(e.value.driver.driversLicenseType==="C1"||e.value.driver.driversLicenseType==="C2")&&a.value.totalPassengerNo>5?(i({type:"danger",message:"您的驾照类型不支持超过5人的拼车"}),!1):a.value.totalPassengerNo<a.value.leftPassengerNo?(i({type:"danger",message:"总乘客人数应大于等于剩余乘客人数"}),!1):!0};return(r,e)=>{const p=j,s=Q,C=H,R=X,P=x,w=K,$=W,A=J;return F(),L(M,null,[o(p,{title:"订单详情","left-text":"返回","left-arrow":"",onClickLeft:e[0]||(e[0]=l=>B(y).go(-1))}),o(A,{onSubmit:e[26]||(e[26]=l=>c())},{default:u(()=>[o($,{inset:""},{default:u(()=>[o(s,{modelValue:a.value.departurePoint,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.departurePoint=l),name:"出发地",label:"出发地",placeholder:"请输入出发地点",rules:[{required:!0,message:"请输入出发地点"}]},null,8,["modelValue"]),o(s,{modelValue:a.value.arrivePoint,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.arrivePoint=l),name:"到达地",label:"到达地",placeholder:"请输入到达地点",rules:[{required:!0,message:"请输入到达地点"}]},null,8,["modelValue"]),o(s,{modelValue:D.value,"onUpdate:modelValue":e[3]||(e[3]=l=>D.value=l),name:"途径地",label:"途径地",placeholder:"多个途径地点之间请用空格隔开"},null,8,["modelValue"]),o(C,{plain:"",block:"",type:"primary",size:"small",style:{width:"40%",margin:"2% auto"},onClick:e[4]||(e[4]=l=>S())},{default:u(()=>[T(" 预览行程路线 ")]),_:1}),o(s,{modelValue:a.value.departureDate,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.departureDate=l),"is-link":"",name:"departureDatePicker",label:"出发日期",placeholder:"点击选择出发日期",onClick:e[6]||(e[6]=l=>m.value=!0),rules:[{required:!0,message:"请选择出发日期"}]},null,8,["modelValue"]),o(P,{show:m.value,"onUpdate:show":e[8]||(e[8]=l=>m.value=l),position:"bottom"},{default:u(()=>[o(R,{"min-date":r.today,onConfirm:r.onDepartureDateConfirm,onCancel:e[7]||(e[7]=l=>m.value=!1)},null,8,["min-date","onConfirm"])]),_:1},8,["show"]),o(s,{modelValue:a.value.departureTime,"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.departureTime=l),"is-link":"",name:"departureTimePicker",label:"出发时间",placeholder:"点击选择出发时间",onClick:e[10]||(e[10]=l=>g.value=!0),rules:[{required:!0,message:"请输入出发时间"}]},null,8,["modelValue"]),o(P,{show:g.value,"onUpdate:show":e[12]||(e[12]=l=>g.value=l),position:"bottom"},{default:u(()=>[o(w,{onConfirm:r.onDepartureTimeConfirm,onCancel:e[11]||(e[11]=l=>g.value=!1)},null,8,["onConfirm"])]),_:1},8,["show"]),o(s,{modelValue:a.value.arriveDate,"onUpdate:modelValue":e[13]||(e[13]=l=>a.value.arriveDate=l),"is-link":"",name:"arriveDatePicker",label:"到达日期",placeholder:"选择到达日期(默认当日到达)",onClick:e[14]||(e[14]=l=>v.value=!0),rules:[{required:!0,message:"请选择到达日期"}]},null,8,["modelValue"]),o(P,{show:v.value,"onUpdate:show":e[16]||(e[16]=l=>v.value=l),position:"bottom"},{default:u(()=>[o(R,{"min-date":r.today,onConfirm:r.onArriveDateConfirm,onCancel:e[15]||(e[15]=l=>v.value=!1)},null,8,["min-date","onConfirm"])]),_:1},8,["show"]),o(s,{modelValue:a.value.arriveTime,"onUpdate:modelValue":e[17]||(e[17]=l=>a.value.arriveTime=l),"is-link":"",name:"arriveTimePicker",label:"到达时间",placeholder:"选择到达时间",onClick:e[18]||(e[18]=l=>f.value=!0),rules:[{required:!0,message:"请选择到达时间"}]},null,8,["modelValue"]),o(P,{show:f.value,"onUpdate:show":e[20]||(e[20]=l=>f.value=l),position:"bottom"},{default:u(()=>[o(w,{onConfirm:r.onArriveTimeConfirm,onCancel:e[19]||(e[19]=l=>f.value=!1)},null,8,["onConfirm"])]),_:1},8,["show"]),o(s,{modelValue:a.value.description,"onUpdate:modelValue":e[21]||(e[21]=l=>a.value.description=l),name:"行程描述",label:"行程描述",placeholder:"请输入行程描述",rules:[{required:!0,message:"请输入行程描述"}]},null,8,["modelValue"]),o(s,{modelValue:a.value.totalPassengerNo,"onUpdate:modelValue":e[22]||(e[22]=l=>a.value.totalPassengerNo=l),name:"总座位数",label:"总座位数",placeholder:"请输入总座位数",type:"digit",rules:[{required:!0,message:"请输入总座位数"}]},null,8,["modelValue"]),o(s,{modelValue:a.value.leftPassengerNo,"onUpdate:modelValue":e[23]||(e[23]=l=>a.value.leftPassengerNo=l),name:"剩余座位数",label:"剩余座位数",placeholder:"一般与总座位数一致",type:"digit",rules:[{required:!0,message:"请输入剩余座位数"}]},null,8,["modelValue"]),o(s,{modelValue:a.value.price,"onUpdate:modelValue":e[24]||(e[24]=l=>a.value.price=l),name:"价格",label:"价格",placeholder:"您期望收取乘客的价格",type:"digit",rules:[{required:!0,message:"请输入价格"}]},null,8,["modelValue"]),z("div",ae,[o(C,{plain:"",block:"",type:"primary","native-type":"submit"},{default:u(()=>[T(" 修改行程 ")]),_:1}),o(C,{plain:"",block:"",type:"danger",onClick:e[25]||(e[25]=l=>r.clearAddCarpoolingDto())},{default:u(()=>[T(" 删除行程 ")]),_:1})])]),_:1})]),_:1})],64)}}},ue=ee(le,[["__scopeId","data-v-767b3597"]]);export{ue as default};
