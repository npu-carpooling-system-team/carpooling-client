import{a2 as R,a3 as I,u as L,l as D,a4 as S,w as T,o as q,q as x,s as h,t as _,J as B,a as C,n as E,d as N,e as G,a5 as K,N as U,z,A as O,p as V}from"./.pnpm-678420e1.js";import{_ as W}from"./index-9b9247c5.js";window._AMapSecurityConfig={serviceHost:"https://amap.wangminan.me/_AMapService/backup"};const j=async()=>await R.load({key:"488832cc9add2a49a6f41bf8b8dbf109",version:"2.0",plugins:["AMap.Driving","AMap.Geocoder","AMap.Geolocation","AMap.ToolBar"]}),w=async c=>{const{data:l}=await I.get("https://sts.wangminan.me/amap"),s={key:l.WebApiKey,address:c,city:"西安"},n=await(await fetch(`https://restapi.amap.com/v3/geocode/geo?key=${s.key}&address=${s.address}&city=${s.city}`,{method:"GET"})).json();if(n.info!=="OK")throw new Error("获取经纬度失败");return n.geocodes[0].location.split(",")};const J=c=>(z("data-v-b7b77824"),c=c(),O(),c),F={class:"container"},H=J(()=>V("div",{id:"carpooling-route-map"},null,-1)),Q={__name:"PreviewMap",setup(c){const l=L(),s=D();let i=S(null),n,u,d,g="",m={waypoints:[]};const f=async()=>{const t=await w(s.currentRoute.value.query.departurePoint);u=new n.LngLat(t[0],t[1]);const e=await w(s.currentRoute.value.query.arrivePoint);if(d=new n.LngLat(e[0],e[1]),g=s.currentRoute.value.query.passingPoint,g!==""){const a=g.split(",");for(const o of a){const r=await w(o);m.waypoints.push(new n.LngLat(r[0],r[1]))}}};function k(t){const e=$(t),a=new n.Marker({position:e[0],icon:"https://webapi.amap.com/theme/v1.3/markers/n/start.png",map:i.value}),o=new n.Marker({position:e[e.length-1],icon:"https://webapi.amap.com/theme/v1.3/markers/n/end.png",map:i.value}),r=new n.Polyline({path:e,isOutline:!0,outlineColor:"#ffeeee",borderWeight:2,strokeWeight:5,strokeColor:"#0091ff",lineJoin:"round"});r.setMap(i),i.value.setFitView([a,o,r])}function $(t){const e=[];let a=0,o=t.steps.length;for(;a<o;a++){const r=t.steps[a];let p=0,v=r.path.length;for(;p<v;p++)e.push(r.path[p])}return e}const y=async t=>{i.value=new t.Map("carpooling-route-map",{resizeEnable:!0,mapStyle:l.value?"amap://styles/dark":"amap://styles/normal",viewMode:"3D",zoom:15,center:[108.764362,34.028885]}),new t.Driving({policy:t.DrivingPolicy.LEAST_TIME,map:i.value}).search(u,d,m,function(a,o){a==="complete"?o.routes&&o.routes.length&&k(o.routes[0]):h({type:"danger",message:"路线规划失败，请检查输入地点是否在西安市范围内"})})};T(l,async t=>{console.log(t),await f(),await y(n)});const M=async()=>{const t=K({duration:0,forbidClick:!0,message:"注意: 由于URI SDK只允许一个途经点，因此如果您填入了多个途经点，我们默认使用第一个作为参数。"});let e=4;const a=setInterval(()=>{if(e--,e)t.message=`倒计时 ${e} 秒 
 注意: 由于URI SDK只允许一个途经点，因此如果您填入了多个途经点，我们默认使用只第一个作为参数。`;else{clearInterval(a),_();const o=`${u.lng},${u.lat},${s.currentRoute.value.query.departurePoint}`,r=`${d.lng},${d.lat},${s.currentRoute.value.query.arrivePoint}`,p=`${m.waypoints[0].lng},${m.waypoints[0].lat},${s.currentRoute.value.query.passingPoint}`,v="car",P=0,b="gaode",A=1;window.location.href=`https://uri.amap.com/navigation?' +
                    'policy=${P}&from=${o}&to=${r}&via=${p}&mode=${v}' +
                    '&coordinate=${b}&callnative=${A}`}},1e3)};return q(async()=>{x({duration:0,forbidClick:!0,message:"正在加载地图..."});try{n=await j(),await f(),await y(n)}catch{h({type:"danger",message:"地图加载失败"})}finally{_()}}),B(()=>{document.getElementById("carpooling-route-map").remove()}),(t,e)=>{const a=U;return C(),E("div",F,[N(a,{title:"行程预览","left-text":"返回","right-text":"使用高德地图打开","left-arrow":"",onClickLeft:e[0]||(e[0]=o=>G(s).go(-1)),onClickRight:e[1]||(e[1]=o=>M())}),H])}}},Z=W(Q,[["__scopeId","data-v-b7b77824"]]);export{Z as default};
