import{j as W,k as y,w as X,o,l as A,b as p,a as d,F as Y,d as N,c as i,q as v,v as u,m as x,x as ee,y as ae,s as t,n as k,p as _,z as le,B as te,D as se,E as re,U as ne,A as de}from"./.pnpm-89aee2be.js";import{_ as V,v as I,b as S,c as oe}from"./validatorUtil-9a5b9e7f.js";import{_ as ie}from"./index-ce64f93d.js";const F=async c=>{const g=T(c.content,c.file.name),a=new FormData;return a.append("file",g),await V.post("/api/auth/register/ocr/idCard",a)},ue=async c=>{const g=T(c.content,c.file.name),a=new FormData;return a.append("file",g),await V.post("/api/auth/register/ocr/drivingLicense",a)},ce=async c=>{const g=T(c.content,c.file.name),a=new FormData;return a.append("file",g),await V.post("/api/auth/register/ocr/vehicleLicense",a)};function T(c,g){let a=c.split(","),h=a[0].match(/:(.*?);/)[1],f=window.atob(a[1]),b=f.length,$=new Uint8Array(b);for(;b--;)$[b]=f.charCodeAt(b);return new File([$],g,{type:h})}const E=c=>(ee("data-v-0e28c5d3"),c=c(),ae(),c),me={class:"register-form"},pe=E(()=>x("h3",{class:"title"},"西工大拼车平台——注册",-1)),ve=E(()=>x("h5",null,"用户角色选择(可多选)",-1)),ye={key:4},ge=E(()=>x("a",null,"您确认注册则代表您认可我们的",-1)),fe={class:"submit-login-btn"},be={__name:"UserRegister",setup(c){const g=W(),a=y({username:"",password:"",email:"",isDriver:!1,isPassenger:!1,driversPersonalId:"",driversName:"",driversLicenseNo:"",driversLicenseType:"",driversPlateNo:"",driversVehicleType:"",driversExpireDate:""}),h=y(!0),f=y({phone:"",code:""}),b=y(""),$=async()=>{if(!I(a.value.username)){t({type:"danger",message:"手机号格式不正确"});return}k({duration:0,forbidClick:!0,message:"请求验证码发送中"});const r={phone:a.value.username};try{const{data:e}=await V.post("/api/auth/sendsms",r);if(e.code!==null&&e.code===2e3){t({type:"success",message:"验证码已发送"}),b.value="300s",h.value=!1;let l=300;const s=setInterval(()=>{l--,b.value=l+"s",l===0&&(clearInterval(s),h.value=!0)},1e3)}else t({type:"danger",message:`验证码发送失败,${e.msg},请重试`})}catch(e){t({type:"danger",message:`服务器异常${e},请通知管理员`})}finally{_()}},C=y(!1),M=async()=>{if(f.value.phone=a.value.username,!S(f.value.code)||!I(f.value.phone)){t({type:"danger",message:"格式不正确"});return}k({duration:0,forbidClick:!0,message:"请求验证码验证中"});try{const{data:r}=await V.post("/api/auth/checksms",f.value);r.code!==null&&r.code===2e3?(t({type:"success",message:"验证码验证成功"}),C.value=!0):t({type:"danger",message:`验证码验证失败,${r.msg},请重试`})}catch(r){t({type:"danger",message:`服务器异常${r},请通知管理员`})}finally{_()}},w=y({mail:"",code:""}),z=y(!1),U=y(!0),L=y(""),B=async()=>{if(!/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(a.value.email)){t({type:"danger",message:"邮箱格式不正确"});return}k({duration:0,forbidClick:!0,message:"请求验证码发送中"});const r={email:a.value.email};try{const{data:e}=await V.post("/api/auth/sendmail",r);if(e.code!==null&&e.code===2e3){t({type:"success",message:"验证码已发送"}),L.value="300s",U.value=!1;let l=300;const s=setInterval(()=>{l--,L.value=l+"s",l===0&&(clearInterval(s),U.value=!1)},1e3)}else t({type:"danger",message:`验证码发送失败,${e.msg},请重试`})}catch(e){t({type:"danger",message:`服务器异常${e},请通知管理员`})}finally{_()}},Z=async()=>{if(w.value.mail=a.value.email,!S(w.value.code)||/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(w.value.code)){t({type:"danger",message:"格式不正确"});return}k({duration:0,forbidClick:!0,message:"请求邮箱验证中"});try{const{data:r}=await V.post("/api/auth/checkmail",w.value);r.code!==null&&r.code===2e3?(t({type:"success",message:"邮箱验证成功"}),z.value=!0):t({type:"danger",message:`邮箱验证失败,${r.msg},请重试`})}catch(r){t({type:"danger",message:`服务器异常${r},请通知管理员`})}finally{_()}},P=y([]),m=y(!1),J=async r=>{if(r.content.size>10*1024*1024){t({type:"danger",message:"文件大小不能超过10M"});return}k({duration:0,forbidClick:!0,message:"正在识别身份证"});try{const{data:e}=await F(r);if(e.code===2e3){const l=JSON.parse(e.data);if(l.data.face!==null){const s=l.data.face;if(s.warning.isCopy!==0||s.warning.isReshoot!==0){t({type:"danger",message:"识别到翻拍或复制。请识别原件身份证"});return}a.value.driversName=s.data.name,a.value.driversPersonalId=s.data.idNumber}else t({type:"danger",message:"身份证识别失败,请重试"})}else t({type:"danger",message:`身份证识别失败,${e.msg},请重试`})}catch(e){t({type:"danger",message:`服务器异常${e},请通知管理员`})}finally{_()}},O=async r=>{if(r.content.size>10*1024*1024){t({type:"danger",message:"文件大小不能超过10M"});return}k({duration:0,forbidClick:!0,message:"正在识别身份证"});try{const{data:e}=await F(r);if(e.code===2e3){const l=JSON.parse(e.data);if(l.data.back!==null){const s=l.data.back;if(s.warning.isCopy!==0||s.warning.isReshoot!==0){t({type:"danger",message:"识别到翻拍或复制。请识别原件身份证"});return}s.data.validPeriod.split("-")[1]==="长期"?s.data.validPeriod="2999-12-31":a.value.driversExpireDate=s.data.validPeriod.split("-")[1].replace(/(\d{4})\.(\d{2})\.(\d{2})/,"$1-$2-$3")}else t({type:"danger",message:"请识别身份证反面"})}else t({type:"danger",message:`身份证识别失败,${e.msg},请重试`})}catch(e){t({type:"danger",message:`服务器异常${e},请通知管理员`})}finally{_()}},q=async r=>{if(r.content.size>10*1024*1024){t({type:"danger",message:"文件大小不能超过10M"});return}else a.value.driversName===""&&t({type:"danger",message:"请先识别身份证信息"});k({duration:0,forbidClick:!0,message:"正在识别驾驶证"});try{const{data:e}=await ue(r);if(e.code===2e3){const l=JSON.parse(e.data);if(l.data.face!==null){if(l.data.face.data.name!==a.value.driversName||l.data.face.data.licenseNumber!==a.value.driversPersonalId){t({type:"danger",message:"驾驶证与身份证所属人不一致,请更新材料"});return}a.value.driversLicenseNo=l.data.face.data.licenseNumber,a.value.driversLicenseType=l.data.face.data.approvedType;const s=l.data.face.data.validPeriod.split("至")[1];a.value.driversExpireDate===""?a.value.driversExpireDate=s:a.value.driversExpireDate=a.value.driversExpireDate>s?s:a.value.driversExpireDate}else t({type:"danger",message:"驾驶证识别失败,请重试"})}else t({type:"danger",message:`驾驶证识别失败,${e.msg},请重试`})}catch(e){t({type:"danger",message:`服务器异常${e},请通知管理员`})}finally{_()}},G=async r=>{if(r.content.size>10*1024*1024){t({type:"danger",message:"文件大小不能超过10M"});return}k({duration:0,forbidClick:!0,message:"正在识别行驶证"});try{const{data:e}=await ce(r);if(e.code===2e3){const l=JSON.parse(e.data);if(l.data.face!==null){if(l.data.face.data.owner!==a.value.driversName){t({type:"danger",message:"行驶证与身份证所属人不一致或身份信息为空,请更新材料"});return}else l.data.face.data.useNature!=="非营运"&&t({type:"warning",message:"行驶证非营运,我们建议您更新材料"});a.value.driversPlateNo=l.data.face.data.licensePlateNumber,a.value.driversVehicleType=l.data.face.data.model+" "+l.data.face.data.vehicleType}}else t({type:"danger",message:"行驶证识别失败,请重试"})}catch(e){t({type:"danger",message:`服务器异常${e},请通知管理员`})}finally{_()}};X(P,r=>{m.value=!!r.includes("isDriver")});const j=()=>{};return(r,e)=>{const l=le,s=te,R=se,H=re,D=ne,K=de,Q=Y;return o(),A("div",me,[pe,p(Q,{onSubmit:e[18]||(e[18]=n=>j())},{default:d(()=>[p(K,{inset:"",style:{padding:"1%"}},{default:d(()=>[p(l,{modelValue:a.value.username,"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.username=n),name:"手机号",label:"手机号",placeholder:"请输入手机号",type:"tel",clearable:"",rules:[{validator:N(I),message:"请输入正确的手机号码"}],disabled:C.value},null,8,["modelValue","rules","disabled"]),C.value?u("",!0):(o(),i(l,{key:0,modelValue:f.value.code,"onUpdate:modelValue":e[2]||(e[2]=n=>f.value.code=n),center:"",clearable:"",type:"digit",label:"短信验证码",placeholder:"请输入验证码",rules:[{validator:N(S),message:"应为4位数字"}]},{button:d(()=>[h.value?(o(),i(s,{key:0,size:"small",type:"primary",onClick:e[1]||(e[1]=n=>$()),disabled:C.value},{default:d(()=>[v(" 发送验证码 ")]),_:1},8,["disabled"])):h.value?u("",!0):(o(),i(s,{key:1,size:"small",type:"primary",disabled:"",loading:"","loading-text":b.value},null,8,["loading-text"]))]),_:1},8,["modelValue","rules"])),C.value?u("",!0):(o(),i(s,{key:1,plain:"",block:"",type:"primary",size:"small",style:{width:"40%",margin:"1% auto"},onClick:e[3]||(e[3]=n=>M())},{default:d(()=>[v("验证手机号码")]),_:1})),p(l,{modelValue:a.value.email,"onUpdate:modelValue":e[4]||(e[4]=n=>a.value.email=n),center:"",clearable:"",label:"邮箱",placeholder:"请输入邮箱(非强制)",disabled:z.value},null,8,["modelValue","disabled"]),z.value?u("",!0):(o(),i(l,{key:2,modelValue:w.value.code,"onUpdate:modelValue":e[6]||(e[6]=n=>w.value.code=n),center:"",clearable:"",type:"digit",label:"邮箱验证码",placeholder:"请输入验证码",rules:[{required:!1,validator:N(oe),message:"应为4位数字"}]},{button:d(()=>[U.value?(o(),i(s,{key:0,size:"small",type:"primary",onClick:e[5]||(e[5]=n=>B())},{default:d(()=>[v(" 发送验证码 ")]),_:1})):U.value?u("",!0):(o(),i(s,{key:1,size:"small",type:"primary",disabled:"",loading:"","loading-text":L.value},null,8,["loading-text"]))]),_:1},8,["modelValue","rules"])),z.value?u("",!0):(o(),i(s,{key:3,plain:"",block:"",type:"primary",size:"small",style:{width:"40%",margin:"1% auto"},onClick:e[7]||(e[7]=n=>Z())},{default:d(()=>[v("验证邮箱")]),_:1})),ve,p(H,{modelValue:P.value,"onUpdate:modelValue":e[8]||(e[8]=n=>P.value=n),direction:"horizontal",class:"checkbox-area"},{default:d(()=>[p(R,{name:"isPassenger"},{default:d(()=>[v("我希望拼车-乘客")]),_:1}),p(R,{name:"isDriver"},{default:d(()=>[v("我可以搭人-司机")]),_:1})]),_:1},8,["modelValue"]),m.value?(o(),A("h5",ye,"请您补充以下信息")):u("",!0),m.value?(o(),i(D,{key:5,style:{width:"60%",margin:"0 auto"},"after-read":J},{default:d(()=>[p(s,{plain:"",block:"",type:"primary",size:"small"},{default:d(()=>[v(" 拍摄您的身份证-正面-以自动识别 ")]),_:1})]),_:1})):u("",!0),m.value?(o(),i(D,{key:6,style:{width:"60%",margin:"1% auto"},"after-read":O},{default:d(()=>[p(s,{plain:"",block:"",type:"primary",size:"small"},{default:d(()=>[v(" 拍摄您的身份证-背面-以自动识别 ")]),_:1})]),_:1})):u("",!0),m.value?(o(),i(l,{key:7,modelValue:a.value.driversPersonalId,"onUpdate:modelValue":e[9]||(e[9]=n=>a.value.driversPersonalId=n),center:"",disabled:"",clearable:"",label:"身份证号",placeholder:"该位置会被自动填充"},null,8,["modelValue"])):u("",!0),m.value?(o(),i(l,{key:8,modelValue:a.value.driversName,"onUpdate:modelValue":e[10]||(e[10]=n=>a.value.driversName=n),center:"",disabled:"",clearable:"",label:"真实姓名",placeholder:"该位置会被自动填充"},null,8,["modelValue"])):u("",!0),m.value?(o(),i(D,{key:9,style:{width:"60%",margin:"1% auto"},"after-read":q},{default:d(()=>[p(s,{plain:"",block:"",type:"primary",size:"small"},{default:d(()=>[v(" 拍摄您的驾驶证-主页-以自动识别 ")]),_:1})]),_:1})):u("",!0),m.value?(o(),i(l,{key:10,modelValue:a.value.driversLicenseNo,"onUpdate:modelValue":e[11]||(e[11]=n=>a.value.driversLicenseNo=n),center:"",disabled:"",clearable:"",label:"驾驶证号",placeholder:"该位置会被自动填充"},null,8,["modelValue"])):u("",!0),m.value?(o(),i(l,{key:11,modelValue:a.value.driversLicenseType,"onUpdate:modelValue":e[12]||(e[12]=n=>a.value.driversLicenseType=n),center:"",disabled:"",clearable:"",label:"准驾类型",placeholder:"该位置会被自动填充"},null,8,["modelValue"])):u("",!0),m.value?(o(),i(D,{key:12,style:{width:"60%",margin:"1% auto"},"after-read":G},{default:d(()=>[p(s,{plain:"",block:"",type:"primary",size:"small"},{default:d(()=>[v(" 拍摄您的行驶证-主页-以自动识别 ")]),_:1})]),_:1})):u("",!0),m.value?(o(),i(D,{key:13,style:{width:"60%",margin:"1% auto"}},{default:d(()=>[p(s,{plain:"",block:"",type:"primary",size:"small"},{default:d(()=>[v(" 拍摄您的行驶证-副页-以自动识别 ")]),_:1})]),_:1})):u("",!0),m.value?(o(),i(l,{key:14,modelValue:a.value.driversPlateNo,"onUpdate:modelValue":e[13]||(e[13]=n=>a.value.driversPlateNo=n),center:"",disabled:"",clearable:"",label:"车牌号",placeholder:"该位置会被自动填充"},null,8,["modelValue"])):u("",!0),m.value?(o(),i(l,{key:15,modelValue:a.value.driversVehicleType,"onUpdate:modelValue":e[14]||(e[14]=n=>a.value.driversVehicleType=n),center:"",disabled:"",clearable:"",autosize:"",type:"textarea",label:"车型",placeholder:"该位置会被自动填充"},null,8,["modelValue"])):u("",!0),m.value?(o(),i(l,{key:16,modelValue:a.value.driversExpireDate,"onUpdate:modelValue":e[15]||(e[15]=n=>a.value.driversExpireDate=n),center:"",disabled:"",clearable:"",label:"证照最早过期时间",placeholder:"该位置会被自动填充"},null,8,["modelValue"])):u("",!0)]),_:1}),x("p",null,[ge,x("a",{style:{color:"#5CA0FF"},onClick:e[16]||(e[16]=n=>N(g).push("/privacy"))},"隐私政策")]),x("div",fe,[p(s,{plain:"",block:"",type:"primary","native-type":"submit"},{default:d(()=>[v(" 注册 ")]),_:1}),p(s,{plain:"",block:"",type:"success",onClick:e[17]||(e[17]=n=>N(g).push("/login"))},{default:d(()=>[v(" 返回登录页 ")]),_:1})])]),_:1})])}}},he=ie(be,[["__scopeId","data-v-0e28c5d3"]]);export{he as default};
