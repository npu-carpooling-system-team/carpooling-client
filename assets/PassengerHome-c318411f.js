import{l as M,m as r,o as O,a as D,p as x,d as a,b as o,q as L,Y as S,s as P,F as Y,P as Z,x as m,e as N,Z as J,D as K,a5 as W,E as X,a2 as ee,a3 as ae,a4 as te,G as le,c as oe,y as v,_ as ne,R as se,Q as re,A as ue,B as ie}from"./.pnpm-a881e205.js";import{j as de}from"./index-a1f9e7b3.js";import{_ as pe}from"./index-72251907.js";import"./index-18de323a.js";const me=f=>(ue("data-v-f8b2c367"),f=f(),ie(),f),ve={class:"carpooling-card-container"},ce=me(()=>L("span",null,"-->",-1)),_e={__name:"PassengerHome",setup(f){const $=M(),u=r(""),i=r(""),l=r({pageNum:1,pageSize:10,query:"",departureTime:"",arriveTime:""}),B=new Date;let b=new Date;b.setDate(new Date().getDate()+2);const c=r(!1),_=r(!1),T=r([]),g=r(!1),k=r(!1);let d={query:"",departureTime:"",arriveTime:""},y=!0;const w=async()=>{if(y?y=!y:l.value.pageNum++,(d.query!==l.value.query||d.departureTime!==l.value.departureTime||d.arriveTime!==l.value.arriveTime)&&(y=!0,l.value.pageNum=1,k.value=!1),g.value=!0,u.value!==""&&(l.value.departureTime=u.value,i.value!==""?l.value.departureTime=l.value.departureTime+" "+i.value:l.value.departureTime=l.value.departureTime+" 00:00"),u.value===""&&i.value!==""){P({type:"danger",message:"请选择出发日期"});return}const n=await de(l.value);if(n===null&&P({type:"danger",message:"获取拼车列表失败: 服务器错误"}),n.code===2e3){const t=new Date().toISOString().slice(0,19).replace("T"," ");for(let p=0;p<n.data.length;p++)n.data[p].departureTime<t&&(n.data.splice(p,1),p--);d.query!==l.value.query||d.departureTime!==l.value.departureTime||d.arriveTime!==l.value.arriveTime?(T.value=[],T.value.push(...n.data),d={query:l.value.query,departureTime:l.value.departureTime,arriveTime:l.value.arriveTime}):T.value.push(...n.data),n.total!==l.value.pageSize&&(k.value=!0)}else P({type:"danger",message:`获取拼车列表失败：${n.msg}`});g.value=!1};O(async()=>{await w()});const F=({selectedValues:n})=>{u.value=n.join("-"),c.value=!1},I=({selectedValues:n})=>{i.value=n.join(":"),_.value=!1},U=()=>{u.value="",c.value=!1},j=()=>{i.value="",_.value=!1},z=async n=>{await $.push(`/main/passenger/carpooling-detail?id=${n.id}`)};return(n,t)=>{const p=K,G=W,h=X,H=ee,q=ae,R=te,V=le,E=Y,s=ne,C=se,Q=re,A=Z;return D(),x(S,null,[a(E,{class:"searchForm"},{default:o(()=>[a(V,{inset:""},{default:o(()=>[a(G,{label:"搜索",modelValue:l.value.query,"onUpdate:modelValue":t[1]||(t[1]=e=>l.value.query=e),"show-action":"",placeholder:"请输入搜索关键词",onClear:t[2]||(t[2]=e=>w())},{action:o(()=>[a(p,{plain:"",block:"",type:"primary",size:"mini",onClick:t[0]||(t[0]=e=>w())},{default:o(()=>[m(" 搜索 ")]),_:1})]),_:1},8,["modelValue"]),a(h,{modelValue:u.value,"onUpdate:modelValue":t[3]||(t[3]=e=>u.value=e),"is-link":"",readonly:"",name:"departureDatePicker",label:"出发日期",placeholder:"点击选择出发日期(可空)",onClick:t[4]||(t[4]=e=>c.value=!0),clearable:""},null,8,["modelValue"]),a(q,{show:c.value,"onUpdate:show":t[5]||(t[5]=e=>c.value=e),position:"bottom"},{default:o(()=>[a(H,{"min-date":N(B),"max-date":N(b),onConfirm:F,onCancel:U},null,8,["min-date","max-date"])]),_:1},8,["show"]),a(h,{modelValue:i.value,"onUpdate:modelValue":t[6]||(t[6]=e=>i.value=e),"is-link":"",readonly:"",name:"departureTimePicker",label:"出发时间",placeholder:"点击选择出发时间(可空)",onClick:t[7]||(t[7]=e=>_.value=!0)},null,8,["modelValue"]),a(q,{show:_.value,"onUpdate:show":t[8]||(t[8]=e=>_.value=e),position:"bottom"},{default:o(()=>[a(R,{onConfirm:I,onCancel:j})]),_:1},8,["show"])]),_:1})]),_:1}),L("div",ve,[a(A,{loading:g.value,"onUpdate:loading":t[9]||(t[9]=e=>g.value=e),finished:k.value,"finished-text":"没有更多行程了",onLoad:w},{default:o(()=>[(D(!0),x(S,null,J(T.value,e=>(D(),oe(V,{inset:"",style:{"margin-top":"2%"},key:e},{default:o(()=>[a(Q,{class:"carpoolingItem",onClick:fe=>z(e)},{default:o(()=>[a(C,null,{default:o(()=>[a(s,{span:"12"},{default:o(()=>[m(v(e.departurePoint),1)]),_:2},1024),a(s,{span:"12"},{default:o(()=>[m(v(e.arrivePoint),1)]),_:2},1024)]),_:2},1024),a(C,null,{default:o(()=>[a(s,{span:"11"},{default:o(()=>[m(v(e.departureTime),1)]),_:2},1024),a(s,{span:"2"},{default:o(()=>[ce]),_:1}),a(s,{span:"11"},{default:o(()=>[m(v(e.arriveTime),1)]),_:2},1024)]),_:2},1024),a(C,null,{default:o(()=>[a(s,{span:"11"},{default:o(()=>[m(" 价格: "+v(e.price),1)]),_:2},1024),a(s,{span:"2"}),a(s,{span:"11"},{default:o(()=>[m(" 余座: "+v(e.leftPassengerNo),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1},8,["loading","finished"])])],64)}}},ke=pe(_e,[["__scopeId","data-v-f8b2c367"]]);export{ke as default};
