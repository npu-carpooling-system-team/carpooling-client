import{G as z,m as n,s as p,t as O,q as E,H as q,l as G,o as M,J as R,a as K,n as Q,d as t,b as u,F as W,v as b,e as D,p as T,z as X,A as Y,D as Z,B as ee,$ as ae,a0 as le,a1 as oe,E as te}from"./.pnpm-33e9fd8e.js";import{u as re}from"./index-e4285400.js";import{_ as ne}from"./index-85061a81.js";import{_ as se}from"./index-b9fc8617.js";const ie=z("carpoolingCache",()=>({carpoolingCache:n({departureTime:"",arriveTime:"",departurePoint:"",arrivePoint:"",passingPoint:"",description:"",totalPassengerNo:"",leftPassengerNo:"",price:""})}),{persist:{storage:sessionStorage,paths:["carpoolingCache"],key:"carpoolingCache"}}),ue=s=>{E({duration:0,forbidClick:!0,message:s})},pe=async s=>{ue("正在上传拼车信息");try{const{data:v}=await ne.post("/api/carpooling/driver/carpooling",s);return v}catch(v){p({type:"danger",message:`上传拼车信息失败,${v.message}`})}finally{O()}return!1};const j=s=>(X("data-v-05f5e449"),s=s(),Y(),s),de={class:"driver-home-container"},ve=j(()=>T("h2",null,"添加您的行程",-1)),me=j(()=>T("p",null,"您确认添加行程则代表您认可我们的",-1)),ge={class:"submit-carpooling-btn"},fe={__name:"DriverHome",setup(s){const v=ie(),{carpoolingCache:d}=q(v),N=G(),l=n({departureTime:"",arriveTime:"",departurePoint:"",arrivePoint:"",passingPoint:"",description:"",totalPassengerNo:"",leftPassengerNo:"",price:""}),i=n(""),U=new Date,x=async()=>{if(l.value.departurePoint===""||l.value.arrivePoint===""){p({type:"danger",message:"请输入出发与到达地点"});return}const o=[];i.value!==""&&o.push(i.value.split(" ")),await N.push("/main/driver/preview-map?departurePoint="+l.value.departurePoint+"&arrivePoint="+l.value.arrivePoint+"&passingPoint="+o)},P=n(!1),y=n(!1),C=n(!1),V=n(!1),g=n(""),f=n(""),m=n(""),c=n(""),A=({selectedValues:o})=>{g.value=o.join("-"),m.value=o.join("-"),P.value=!1},B=({selectedValues:o})=>{f.value=o.join(":"),C.value=!1},h=({selectedValues:o})=>{m.value=o.join("-"),y.value=!1},F=({selectedValues:o})=>{c.value=o.join(":"),V.value=!1},L=()=>{if(l.value.departureTime>=l.value.arriveTime)return p({type:"danger",message:"到达时间应在出发时间之后"}),!1;let o=new Date().toLocaleString("zh",{hour12:!1});if(o=o.replace(/\//g,"-"),o.split("-")[1].length===1&&(o=o.replace(/-/,"-0")),l.value.departureTime<=o)return p({type:"danger",message:"出发时间应当在当前时间之后"}),!1;const e=re(),{currentUser:r}=q(e);return(r.value.driver.driversLicenseType==="C1"||r.value.driver.driversLicenseType==="C2")&&l.value.totalPassengerNo>5?(p({type:"danger",message:"您的驾照类型不支持超过5人的拼车"}),!1):l.value.totalPassengerNo<l.value.leftPassengerNo?(p({type:"danger",message:"总乘客人数应大于等于剩余乘客人数"}),!1):!0},$=()=>{l.value={departureTime:"",arriveTime:"",departurePoint:"",arrivePoint:"",passingPoint:"",description:"",totalPassengerNo:"",leftPassengerNo:"",price:""},i.value="",g.value="",f.value="",m.value="",c.value="",v.$patch(o=>{o.carpoolingCache=l.value})},H=async()=>{if(l.value.passingPoint=JSON.stringify(i.value.split(" ")),l.value.departureTime=g.value+" "+f.value,l.value.arriveTime=m.value+" "+c.value,!L())return;const o=await pe(l.value);o.code===2e3?(p({type:"success",message:"发布成功,请到详情页查看"}),$()):o.msg!==null?p({type:"danger",message:`发布失败,${o.msg}`}):p({type:"danger",message:"发布失败"})};return M(()=>{d.value.departurePoint!==""&&(l.value=d.value,i.value=d.value.passingPoint===""?"":JSON.parse(d.value.passingPoint).join(" "),g.value=d.value.departureTime.split(" ")[0],f.value=d.value.departureTime.split(" ")[1],m.value=d.value.arriveTime.split(" ")[0],c.value=d.value.arriveTime.split(" ")[1])}),R(()=>{l.value.passingPoint=i.value===""?"":JSON.stringify(i.value.split(" ")),v.$patch(o=>{o.carpoolingCache=l.value})}),(o,e)=>{const r=Z,w=ee,S=ae,k=le,_=oe,I=te,J=W;return K(),Q("div",de,[ve,t(J,{onSubmit:e[26]||(e[26]=a=>H())},{default:u(()=>[t(I,{inset:""},{default:u(()=>[t(r,{modelValue:l.value.departurePoint,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.departurePoint=a),name:"出发地",label:"出发地",placeholder:"请输入出发地点",rules:[{required:!0,message:"请输入出发地点"}]},null,8,["modelValue"]),t(r,{modelValue:l.value.arrivePoint,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.arrivePoint=a),name:"到达地",label:"到达地",placeholder:"请输入到达地点",rules:[{required:!0,message:"请输入到达地点"}]},null,8,["modelValue"]),t(r,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=a=>i.value=a),name:"途径地",label:"途径地",placeholder:"多个途径地点之间请用空格隔开"},null,8,["modelValue"]),t(w,{plain:"",block:"",type:"primary",size:"small",style:{width:"40%",margin:"2% auto"},onClick:e[3]||(e[3]=a=>x())},{default:u(()=>[b(" 预览行程路线 ")]),_:1}),t(r,{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=a=>g.value=a),"is-link":"",readonly:"",name:"departureDatePicker",label:"出发日期",placeholder:"点击选择出发日期",onClick:e[5]||(e[5]=a=>P.value=!0),rules:[{required:!0,message:"请选择出发日期"}]},null,8,["modelValue"]),t(k,{show:P.value,"onUpdate:show":e[7]||(e[7]=a=>P.value=a),position:"bottom"},{default:u(()=>[t(S,{"min-date":D(U),onConfirm:A,onCancel:e[6]||(e[6]=a=>P.value=!1)},null,8,["min-date"])]),_:1},8,["show"]),t(r,{modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=a=>f.value=a),"is-link":"",readonly:"",name:"departureTimePicker",label:"出发时间",placeholder:"点击选择出发时间",onClick:e[9]||(e[9]=a=>C.value=!0),rules:[{required:!0,message:"请输入出发时间"}]},null,8,["modelValue"]),t(k,{show:C.value,"onUpdate:show":e[11]||(e[11]=a=>C.value=a),position:"bottom"},{default:u(()=>[t(_,{onConfirm:B,onCancel:e[10]||(e[10]=a=>C.value=!1)})]),_:1},8,["show"]),t(r,{modelValue:m.value,"onUpdate:modelValue":e[12]||(e[12]=a=>m.value=a),"is-link":"",readonly:"",name:"arriveDatePicker",label:"到达日期",placeholder:"选择到达日期(默认当日到达)",onClick:e[13]||(e[13]=a=>y.value=!0),rules:[{required:!0,message:"请选择到达日期"}]},null,8,["modelValue"]),t(k,{show:y.value,"onUpdate:show":e[15]||(e[15]=a=>y.value=a),position:"bottom"},{default:u(()=>[t(S,{"min-date":D(U),onConfirm:h,onCancel:e[14]||(e[14]=a=>y.value=!1)},null,8,["min-date"])]),_:1},8,["show"]),t(r,{modelValue:c.value,"onUpdate:modelValue":e[16]||(e[16]=a=>c.value=a),"is-link":"",readonly:"",name:"arriveTimePicker",label:"到达时间",placeholder:"选择到达时间",onClick:e[17]||(e[17]=a=>V.value=!0),rules:[{required:!0,message:"请选择到达时间"}]},null,8,["modelValue"]),t(k,{show:V.value,"onUpdate:show":e[19]||(e[19]=a=>V.value=a),position:"bottom"},{default:u(()=>[t(_,{onConfirm:F,onCancel:e[18]||(e[18]=a=>V.value=!1)})]),_:1},8,["show"]),t(r,{modelValue:l.value.description,"onUpdate:modelValue":e[20]||(e[20]=a=>l.value.description=a),name:"行程描述",label:"行程描述",placeholder:"请输入行程描述",rules:[{required:!0,message:"请输入行程描述"}]},null,8,["modelValue"]),t(r,{modelValue:l.value.totalPassengerNo,"onUpdate:modelValue":e[21]||(e[21]=a=>l.value.totalPassengerNo=a),name:"总座位数",label:"总座位数",placeholder:"请输入总座位数",type:"digit",rules:[{required:!0,message:"请输入总座位数"}]},null,8,["modelValue"]),t(r,{modelValue:l.value.leftPassengerNo,"onUpdate:modelValue":e[22]||(e[22]=a=>l.value.leftPassengerNo=a),name:"剩余座位数",label:"剩余座位数",placeholder:"一般与总座位数一致",type:"digit",rules:[{required:!0,message:"请输入剩余座位数"}]},null,8,["modelValue"]),t(r,{modelValue:l.value.price,"onUpdate:modelValue":e[23]||(e[23]=a=>l.value.price=a),name:"价格",label:"价格",placeholder:"您期望收取乘客的价格",type:"digit",rules:[{required:!0,message:"请输入价格"}]},null,8,["modelValue"]),T("div",null,[me,T("p",{style:{color:"#5CA0FF"},onClick:e[24]||(e[24]=a=>D(N).push("/main/driver/fee-policy"))}," 服务费率政策 ")]),T("div",ge,[t(w,{plain:"",block:"",type:"primary","native-type":"submit"},{default:u(()=>[b(" 添加行程 ")]),_:1}),t(w,{plain:"",block:"",type:"success",onClick:e[25]||(e[25]=a=>$())},{default:u(()=>[b(" 清空数据 ")]),_:1})])]),_:1})]),_:1})])}}},Ve=se(fe,[["__scopeId","data-v-05f5e449"]]);export{Ve as default};
