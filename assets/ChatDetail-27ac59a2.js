import{l as S,m as d,H as $,o as z,a as m,n as w,d as e,e as _,b as a,p as r,c as C,y as F,V as U,s as b,N as G,E as M,O as q,Y as H,B as O,D as P,x as p,a7 as Y,I as Z,Z as j,R as A,P as J}from"./.pnpm-ebac48d5.js";import{b as K,c as Q}from"./index-9b5987c8.js";import{u as W}from"./index-295a5901.js";import{_ as X}from"./index-a752f00d.js";import"./index-d8a8587d.js";const ee={class:"message-div"},te={class:"input-container"},ae={__name:"ChatDetail",setup(oe){const v=S();let u;const n=d({}),f=d("发送第一条信息后可见对方账号"),V=W(),{currentUser:I}=$(V),i=d(""),g=async()=>{const s=await K();s.code===2e3?s.result!==null&&(n.value=s.result.list.find(t=>t.toUserVo.id===u),f.value=n.value.toUserVo.username):b({type:"danger",message:`获取聊天详情失败,${s.msg}`})},T=async()=>{const s={toUserId:u,message:i.value},t=await Q(s);t.code===2e3?(i.value="",await g()):b({type:"danger",message:`发送失败,${t.msg}`})};let c;z(async()=>{c=0,u=v.currentRoute.value.query.toUserId,await g()});const l=d(!0);return window.onscroll=function(){document.documentElement.scrollTop<5&&(l.value=!0),document.documentElement.scrollTop-c>10&&l.value?(l.value=!1,c=document.documentElement.scrollTop):c-document.documentElement.scrollTop>10&&!l.value&&(l.value=!0,c=document.documentElement.scrollTop)},(s,t)=>{const x=G,k=Y,B=Z,h=j,D=A,E=J,y=M,N=q,R=O,L=P;return m(),w(U,null,[e(x,{title:f.value,"left-text":"返回","left-arrow":"",onClickLeft:t[0]||(t[0]=o=>_(v).go(-1))},null,8,["title"]),e(N,{finished:!0,"finished-text":"没有更多聊天了"},{default:a(()=>[(m(!0),w(U,null,H(n.value.chats,o=>(m(),C(y,{style:{"margin-top":"2%"},key:o,inset:""},{default:a(()=>[e(E,{class:"chatItem"},{default:a(()=>[e(D,null,{default:a(()=>[e(h,{span:"8",class:"avatar-col"},{default:a(()=>[e(B,{round:"",width:"3rem",height:"3rem",src:o.fromUserId===_(u)?n.value.toUserVo.avatar:_(I).user.userImage,fit:"cover"},{loading:a(()=>[e(k,{type:"spinner",size:"20"})]),_:2},1032,["src"]),r("div",null,[r("strong",null,p(o.fromUserId===n.value.toUserVo.id?n.value.toUserVo.username:"您"),1)])]),_:2},1024),e(h,{span:"16",class:"chat-col"},{default:a(()=>[r("div",null,[r("div",ee,p(o.message),1),r("div",null,p(o.sendTime),1)])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),r("div",te,[l.value?(m(),C(y,{key:0,class:"chat-input",inset:""},{default:a(()=>[e(L,{center:"",label:"您的留言","label-align":"center",rows:"1",modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=o=>i.value=o)},{button:a(()=>[e(R,{size:"small",type:"primary",icon:"guide-o",onClick:T})]),_:1},8,["modelValue"])]),_:1})):F("",!0)])],64)}}},ue=X(ae,[["__scopeId","data-v-bb8000d2"]]);export{ue as default};
