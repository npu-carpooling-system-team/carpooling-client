import{k as S,l as d,H as $,m as z,o as m,n as w,b as e,d as _,a,p as r,c as C,y as F,V as U,s as V,N as G,E as M,O as q,Y as H,B as O,D as P,x as p,a7 as Y,I as j,a1 as A,R as J,P as K}from"./.pnpm-f0908098.js";import{b as Q,c as W}from"./index-deeab927.js";import{u as X}from"./index-f4a27562.js";import{_ as Z}from"./index-25e647bd.js";import"./index-46d97138.js";const ee={class:"message-div"},te={class:"input-container"},ae={__name:"ChatDetail",setup(se){const v=S();let c;const n=d({}),f=d("发送第一条信息后可见对方账号"),I=X(),{currentUser:T}=$(I),i=d(""),g=async()=>{const o=await Q();o.code===2e3?o.result!==null&&(n.value=o.result.list.find(t=>t.toUserVo.id===c),f.value=n.value.toUserVo.username):V({type:"danger",message:`获取聊天详情失败,${o.msg}`})},b=async()=>{const o={toUserId:c,message:i.value},t=await W(o);t.code===2e3?(i.value="",await g()):V({type:"danger",message:`发送失败,${t.msg}`})};let u;z(async()=>{u=0,c=v.currentRoute.value.query.toUserId,await g()});const l=d(!0);return window.onscroll=function(){document.documentElement.scrollTop<5&&(l.value=!0),document.documentElement.scrollTop-u>10&&l.value?(l.value=!1,u=document.documentElement.scrollTop):u-document.documentElement.scrollTop>10&&!l.value&&(l.value=!0,u=document.documentElement.scrollTop)},(o,t)=>{const k=G,x=Y,B=j,h=A,D=J,E=K,y=M,N=q,R=O,L=P;return m(),w(U,null,[e(k,{title:f.value,"left-text":"返回","left-arrow":"",onClickLeft:t[0]||(t[0]=s=>_(v).go(-1))},null,8,["title"]),e(N,{finished:!0,"finished-text":"没有更多聊天了"},{default:a(()=>[(m(!0),w(U,null,H(n.value.chats,s=>(m(),C(y,{style:{"margin-top":"2%"},key:s,inset:""},{default:a(()=>[e(E,{class:"chatItem"},{default:a(()=>[e(D,null,{default:a(()=>[e(h,{span:"8",class:"avatar-col"},{default:a(()=>[e(B,{round:"",width:"3rem",height:"3rem",src:s.fromUserId===_(c)?n.value.toUserVo.avatar:_(T).user.userImage},{loading:a(()=>[e(x,{type:"spinner",size:"20"})]),_:2},1032,["src"]),r("div",null,[r("strong",null,p(s.fromUserId===n.value.toUserVo.id?n.value.toUserVo.username:"您"),1)])]),_:2},1024),e(h,{span:"16",class:"chat-col"},{default:a(()=>[r("div",null,[r("div",ee,p(s.message),1),r("div",null,p(s.sendTime),1)])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),r("div",te,[l.value?(m(),C(y,{key:0,class:"chat-input",inset:""},{default:a(()=>[e(L,{center:"",label:"您的留言","label-align":"center",rows:"1",modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=s=>i.value=s)},{button:a(()=>[e(R,{size:"small",type:"primary",icon:"guide-o",onClick:b})]),_:1},8,["modelValue"])]),_:1})):F("",!0)])],64)}}},ce=Z(ae,[["__scopeId","data-v-1a5df4a5"]]);export{ce as default};
